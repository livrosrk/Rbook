<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Dplyr | R</title>
  <meta name="description" content="This is a book about what I learned with R" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Dplyr | R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a book about what I learned with R" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Dplyr | R" />
  
  <meta name="twitter:description" content="This is a book about what I learned with R" />
  

<meta name="author" content="Chapter 4 Dplyr | Robin Kohrs" />


<meta name="date" content="2022-07-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-types.html"/>
<link rel="next" href="mapping.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">How I use R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> This is the index page</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Intro</a>
<ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#attach-a-datframe"><i class="fa fa-check"></i><b>2.1</b> <code>attach</code> a datframe</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-types.html"><a href="data-types.html"><i class="fa fa-check"></i><b>3</b> Data Types</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-types.html"><a href="data-types.html#d"><i class="fa fa-check"></i><b>3.1</b> 1D</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="data-types.html"><a href="data-types.html#homogenoues"><i class="fa fa-check"></i><b>3.1.1</b> Homogenoues</a></li>
<li class="chapter" data-level="3.1.2" data-path="data-types.html"><a href="data-types.html#heterogenous"><i class="fa fa-check"></i><b>3.1.2</b> Heterogenous</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="data-types.html"><a href="data-types.html#d-1"><i class="fa fa-check"></i><b>3.2</b> 2D</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="data-types.html"><a href="data-types.html#homogenoues-1"><i class="fa fa-check"></i><b>3.2.1</b> Homogenoues</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-types.html"><a href="data-types.html#heterogenous-1"><i class="fa fa-check"></i><b>3.2.2</b> Heterogenous</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-types.html"><a href="data-types.html#nd"><i class="fa fa-check"></i><b>3.3</b> nd</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="data-types.html"><a href="data-types.html#homogenoues-2"><i class="fa fa-check"></i><b>3.3.1</b> Homogenoues</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>4</b> Dplyr</a>
<ul>
<li class="chapter" data-level="4.1" data-path="dplyr.html"><a href="dplyr.html#ressources"><i class="fa fa-check"></i><b>4.1</b> Ressources</a></li>
<li class="chapter" data-level="4.2" data-path="dplyr.html"><a href="dplyr.html#what-is-tidy-select"><i class="fa fa-check"></i><b>4.2</b> What is <code>tidy-select</code></a></li>
<li class="chapter" data-level="4.3" data-path="dplyr.html"><a href="dplyr.html#selecting-columns"><i class="fa fa-check"></i><b>4.3</b> Selecting columns</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="dplyr.html"><a href="dplyr.html#selecting-columns-based-on-regex"><i class="fa fa-check"></i><b>4.3.1</b> Selecting columns based on regex</a></li>
<li class="chapter" data-level="4.3.2" data-path="dplyr.html"><a href="dplyr.html#selecting-columns-based-if-any-value-in-the-column-is-na"><i class="fa fa-check"></i><b>4.3.2</b> Selecting Columns based if any value in the column is <code>na</code></a></li>
<li class="chapter" data-level="4.3.3" data-path="dplyr.html"><a href="dplyr.html#selecting-columns-if-the-mean-is"><i class="fa fa-check"></i><b>4.3.3</b> Selecting Columns if the mean is &gt; …</a></li>
<li class="chapter" data-level="4.3.4" data-path="dplyr.html"><a href="dplyr.html#select-columns-if-the-first-value-in-the-column-is"><i class="fa fa-check"></i><b>4.3.4</b> Select Columns if the first value in the column is …</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="dplyr.html"><a href="dplyr.html#filtering-rows"><i class="fa fa-check"></i><b>4.4</b> Filtering Rows</a></li>
<li class="chapter" data-level="4.5" data-path="dplyr.html"><a href="dplyr.html#rowwise-compute-new-column-with-subset-of-existing-columns"><i class="fa fa-check"></i><b>4.5</b> Rowwise Compute new Column with subset of existing columns</a></li>
<li class="chapter" data-level="4.6" data-path="dplyr.html"><a href="dplyr.html#adding-column-indicating-if-group-if-max-value-in-group-is-in-top-n-max-values-per-group"><i class="fa fa-check"></i><b>4.6</b> Adding column indicating if group if max value in group is in top-n max values per group</a></li>
<li class="chapter" data-level="4.7" data-path="dplyr.html"><a href="dplyr.html#list-columns-and-dplyr"><i class="fa fa-check"></i><b>4.7</b> list Columns (and <code>dplyr</code>)</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="dplyr.html"><a href="dplyr.html#creating-list-columns"><i class="fa fa-check"></i><b>4.7.1</b> Creating List Columns</a></li>
<li class="chapter" data-level="4.7.2" data-path="dplyr.html"><a href="dplyr.html#manipulating"><i class="fa fa-check"></i><b>4.7.2</b> Manipulating</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mapping.html"><a href="mapping.html"><i class="fa fa-check"></i><b>5</b> Mapping</a>
<ul>
<li class="chapter" data-level="5.1" data-path="mapping.html"><a href="mapping.html#baseapply"><i class="fa fa-check"></i><b>5.1</b> <code>base::apply</code></a></li>
<li class="chapter" data-level="5.2" data-path="mapping.html"><a href="mapping.html#purrmap"><i class="fa fa-check"></i><b>5.2</b> <code>purr::map</code></a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="mapping.html"><a href="mapping.html#find-the-number-of-nas-per-column-in-a-dataframe"><i class="fa fa-check"></i><b>5.2.1</b> Find the number of NAs per column in a dataframe</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="mapping.html"><a href="mapping.html#purrrmap2"><i class="fa fa-check"></i><b>5.3</b> <code>purrr::map2</code></a></li>
<li class="chapter" data-level="5.4" data-path="mapping.html"><a href="mapping.html#purrrpmap"><i class="fa fa-check"></i><b>5.4</b> <code>purrr::pmap</code></a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="mapping.html"><a href="mapping.html#count-the-number-of-numeric-columns"><i class="fa fa-check"></i><b>5.4.1</b> Count the number of numeric columns</a></li>
<li class="chapter" data-level="5.4.2" data-path="mapping.html"><a href="mapping.html#turn-each-row-into-a-list"><i class="fa fa-check"></i><b>5.4.2</b> turn each row into a list</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ggplot.html"><a href="ggplot.html"><i class="fa fa-check"></i><b>6</b> GGPLOT</a>
<ul>
<li class="chapter" data-level="6.1" data-path="ggplot.html"><a href="ggplot.html#internals"><i class="fa fa-check"></i><b>6.1</b> Internals</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="ggplot.html"><a href="ggplot.html#inspecting-a-horizontal-stacked-bar-chart"><i class="fa fa-check"></i><b>6.1.1</b> Inspecting a Horizontal Stacked Bar Chart</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="ggplot.html"><a href="ggplot.html#examples"><i class="fa fa-check"></i><b>6.2</b> Examples</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="ggplot.html"><a href="ggplot.html#stacked-horizontal-chicklets"><i class="fa fa-check"></i><b>6.2.1</b> 1: Stacked Horizontal Chicklets</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dplyr" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Dplyr<a href="dplyr.html#dplyr" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="dplyr.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb10-2"><a href="dplyr.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span></code></pre></div>
<div id="ressources" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Ressources<a href="dplyr.html#ressources" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="what-is-tidy-select" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> What is <code>tidy-select</code><a href="dplyr.html#what-is-tidy-select" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p><a href="https://dplyr.tidyverse.org/reference/select.html">Official docs here</a></p></li>
<li><p>In the end you always want a boolean vector that has the length of the number of columns</p></li>
</ul>
</div>
<div id="selecting-columns" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Selecting columns<a href="dplyr.html#selecting-columns" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="selecting-columns-based-on-regex" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Selecting columns based on regex<a href="dplyr.html#selecting-columns-based-on-regex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p><a href="https://tidyselect.r-lib.org/reference/starts_with.html">Look here</a> for all the possible helper functions.</p></li>
<li><p>If you wanna apply a regex yourself you can use the <code>matches</code>-function. However there are “helpers” e.g. <code>starts_with</code>…</p></li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="dplyr.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select all columns with three characters</span></span>
<span id="cb11-2"><a href="dplyr.html#cb11-2" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="dplyr.html#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb11-4"><a href="dplyr.html#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matches</span>(<span class="st">&quot;^[a-zA-Z]{3}$&quot;</span>)</span>
<span id="cb11-5"><a href="dplyr.html#cb11-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>##                      mpg cyl
## Mazda RX4           21.0   6
## Mazda RX4 Wag       21.0   6
## Datsun 710          22.8   4
## Hornet 4 Drive      21.4   6
## Hornet Sportabout   18.7   8
## Valiant             18.1   6
## Duster 360          14.3   8
## Merc 240D           24.4   4
## Merc 230            22.8   4
## Merc 280            19.2   6
## Merc 280C           17.8   6
## Merc 450SE          16.4   8
## Merc 450SL          17.3   8
## Merc 450SLC         15.2   8
## Cadillac Fleetwood  10.4   8
## Lincoln Continental 10.4   8
## Chrysler Imperial   14.7   8
## Fiat 128            32.4   4
## Honda Civic         30.4   4
## Toyota Corolla      33.9   4
## Toyota Corona       21.5   4
## Dodge Challenger    15.5   8
## AMC Javelin         15.2   8
## Camaro Z28          13.3   8
## Pontiac Firebird    19.2   8
## Fiat X1-9           27.3   4
## Porsche 914-2       26.0   4
## Lotus Europa        30.4   4
## Ford Pantera L      15.8   8
## Ferrari Dino        19.7   6
## Maserati Bora       15.0   8
## Volvo 142E          21.4   4</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="dplyr.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cant use logical vector is select (e.g select(mtcars, c(TRUE, FALSE))) does not work</span></span>
<span id="cb13-2"><a href="dplyr.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Must be indexes!</span></span>
<span id="cb13-3"><a href="dplyr.html#cb13-3" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="dplyr.html#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb13-5"><a href="dplyr.html#cb13-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">which</span>(<span class="fu">grepl</span>(<span class="st">&quot;^[a-zA-Z]{3}$&quot;</span>, <span class="fu">names</span>(.)))</span>
<span id="cb13-6"><a href="dplyr.html#cb13-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>##                      mpg cyl
## Mazda RX4           21.0   6
## Mazda RX4 Wag       21.0   6
## Datsun 710          22.8   4
## Hornet 4 Drive      21.4   6
## Hornet Sportabout   18.7   8
## Valiant             18.1   6
## Duster 360          14.3   8
## Merc 240D           24.4   4
## Merc 230            22.8   4
## Merc 280            19.2   6
## Merc 280C           17.8   6
## Merc 450SE          16.4   8
## Merc 450SL          17.3   8
## Merc 450SLC         15.2   8
## Cadillac Fleetwood  10.4   8
## Lincoln Continental 10.4   8
## Chrysler Imperial   14.7   8
## Fiat 128            32.4   4
## Honda Civic         30.4   4
## Toyota Corolla      33.9   4
## Toyota Corona       21.5   4
## Dodge Challenger    15.5   8
## AMC Javelin         15.2   8
## Camaro Z28          13.3   8
## Pontiac Firebird    19.2   8
## Fiat X1-9           27.3   4
## Porsche 914-2       26.0   4
## Lotus Europa        30.4   4
## Ford Pantera L      15.8   8
## Ferrari Dino        19.7   6
## Maserati Bora       15.0   8
## Volvo 142E          21.4   4</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="dplyr.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select_if can use a boolean vector!! However is superseeded</span></span>
<span id="cb15-2"><a href="dplyr.html#cb15-2" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="dplyr.html#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_if</span>(</span>
<span id="cb15-4"><a href="dplyr.html#cb15-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">&quot;^[a-zA-Z]{3}$&quot;</span>, <span class="fu">names</span>(.))</span>
<span id="cb15-5"><a href="dplyr.html#cb15-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>##                      mpg cyl
## Mazda RX4           21.0   6
## Mazda RX4 Wag       21.0   6
## Datsun 710          22.8   4
## Hornet 4 Drive      21.4   6
## Hornet Sportabout   18.7   8
## Valiant             18.1   6
## Duster 360          14.3   8
## Merc 240D           24.4   4
## Merc 230            22.8   4
## Merc 280            19.2   6
## Merc 280C           17.8   6
## Merc 450SE          16.4   8
## Merc 450SL          17.3   8
## Merc 450SLC         15.2   8
## Cadillac Fleetwood  10.4   8
## Lincoln Continental 10.4   8
## Chrysler Imperial   14.7   8
## Fiat 128            32.4   4
## Honda Civic         30.4   4
## Toyota Corolla      33.9   4
## Toyota Corona       21.5   4
## Dodge Challenger    15.5   8
## AMC Javelin         15.2   8
## Camaro Z28          13.3   8
## Pontiac Firebird    19.2   8
## Fiat X1-9           27.3   4
## Porsche 914-2       26.0   4
## Lotus Europa        30.4   4
## Ford Pantera L      15.8   8
## Ferrari Dino        19.7   6
## Maserati Bora       15.0   8
## Volvo 142E          21.4   4</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="dplyr.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># do the same in base r</span></span>
<span id="cb17-2"><a href="dplyr.html#cb17-2" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">=</span> <span class="fu">grepl</span>(<span class="st">&quot;^[a-zA-Z]{3}$&quot;</span>, <span class="fu">names</span>(mtcars))</span>
<span id="cb17-3"><a href="dplyr.html#cb17-3" aria-hidden="true" tabindex="-1"></a>mtcars[, idx]</span></code></pre></div>
<pre><code>##                      mpg cyl
## Mazda RX4           21.0   6
## Mazda RX4 Wag       21.0   6
## Datsun 710          22.8   4
## Hornet 4 Drive      21.4   6
## Hornet Sportabout   18.7   8
## Valiant             18.1   6
## Duster 360          14.3   8
## Merc 240D           24.4   4
## Merc 230            22.8   4
## Merc 280            19.2   6
## Merc 280C           17.8   6
## Merc 450SE          16.4   8
## Merc 450SL          17.3   8
## Merc 450SLC         15.2   8
## Cadillac Fleetwood  10.4   8
## Lincoln Continental 10.4   8
## Chrysler Imperial   14.7   8
## Fiat 128            32.4   4
## Honda Civic         30.4   4
## Toyota Corolla      33.9   4
## Toyota Corona       21.5   4
## Dodge Challenger    15.5   8
## AMC Javelin         15.2   8
## Camaro Z28          13.3   8
## Pontiac Firebird    19.2   8
## Fiat X1-9           27.3   4
## Porsche 914-2       26.0   4
## Lotus Europa        30.4   4
## Ford Pantera L      15.8   8
## Ferrari Dino        19.7   6
## Maserati Bora       15.0   8
## Volvo 142E          21.4   4</code></pre>
</div>
<div id="selecting-columns-based-if-any-value-in-the-column-is-na" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Selecting Columns based if any value in the column is <code>na</code><a href="dplyr.html#selecting-columns-based-if-any-value-in-the-column-is-na" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Approach 1</strong></p>
<blockquote>
<p>select(where(function(x){
mean(x) &gt; …
}))</p>
</blockquote>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="dplyr.html#cb19-1" aria-hidden="true" tabindex="-1"></a>mtcars_copy <span class="ot">=</span> mtcars</span>
<span id="cb19-2"><a href="dplyr.html#cb19-2" aria-hidden="true" tabindex="-1"></a>mtcars_copy[<span class="dv">2</span>,<span class="dv">2</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb19-3"><a href="dplyr.html#cb19-3" aria-hidden="true" tabindex="-1"></a>mtcars_copy <span class="sc">%&gt;%</span> head</span></code></pre></div>
<pre><code>##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0  NA  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="dplyr.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. </span></span>
<span id="cb21-2"><a href="dplyr.html#cb21-2" aria-hidden="true" tabindex="-1"></a>mtcars_copy <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="dplyr.html#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(<span class="cf">function</span>(x) {</span>
<span id="cb21-4"><a href="dplyr.html#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(<span class="fu">is.na</span>(x)) <span class="sc">==</span> <span class="dv">0</span></span>
<span id="cb21-5"><a href="dplyr.html#cb21-5" aria-hidden="true" tabindex="-1"></a>  }))</span></code></pre></div>
<pre><code>##                      mpg  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4           21.0 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag       21.0 160.0 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710          22.8 108.0  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive      21.4 258.0 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout   18.7 360.0 175 3.15 3.440 17.02  0  0    3    2
## Valiant             18.1 225.0 105 2.76 3.460 20.22  1  0    3    1
## Duster 360          14.3 360.0 245 3.21 3.570 15.84  0  0    3    4
## Merc 240D           24.4 146.7  62 3.69 3.190 20.00  1  0    4    2
## Merc 230            22.8 140.8  95 3.92 3.150 22.90  1  0    4    2
## Merc 280            19.2 167.6 123 3.92 3.440 18.30  1  0    4    4
## Merc 280C           17.8 167.6 123 3.92 3.440 18.90  1  0    4    4
## Merc 450SE          16.4 275.8 180 3.07 4.070 17.40  0  0    3    3
## Merc 450SL          17.3 275.8 180 3.07 3.730 17.60  0  0    3    3
## Merc 450SLC         15.2 275.8 180 3.07 3.780 18.00  0  0    3    3
## Cadillac Fleetwood  10.4 472.0 205 2.93 5.250 17.98  0  0    3    4
## Lincoln Continental 10.4 460.0 215 3.00 5.424 17.82  0  0    3    4
## Chrysler Imperial   14.7 440.0 230 3.23 5.345 17.42  0  0    3    4
## Fiat 128            32.4  78.7  66 4.08 2.200 19.47  1  1    4    1
## Honda Civic         30.4  75.7  52 4.93 1.615 18.52  1  1    4    2
## Toyota Corolla      33.9  71.1  65 4.22 1.835 19.90  1  1    4    1
## Toyota Corona       21.5 120.1  97 3.70 2.465 20.01  1  0    3    1
## Dodge Challenger    15.5 318.0 150 2.76 3.520 16.87  0  0    3    2
## AMC Javelin         15.2 304.0 150 3.15 3.435 17.30  0  0    3    2
## Camaro Z28          13.3 350.0 245 3.73 3.840 15.41  0  0    3    4
## Pontiac Firebird    19.2 400.0 175 3.08 3.845 17.05  0  0    3    2
## Fiat X1-9           27.3  79.0  66 4.08 1.935 18.90  1  1    4    1
## Porsche 914-2       26.0 120.3  91 4.43 2.140 16.70  0  1    5    2
## Lotus Europa        30.4  95.1 113 3.77 1.513 16.90  1  1    5    2
## Ford Pantera L      15.8 351.0 264 4.22 3.170 14.50  0  1    5    4
## Ferrari Dino        19.7 145.0 175 3.62 2.770 15.50  0  1    5    6
## Maserati Bora       15.0 301.0 335 3.54 3.570 14.60  0  1    5    8
## Volvo 142E          21.4 121.0 109 4.11 2.780 18.60  1  1    4    2</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="dplyr.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. base r</span></span>
<span id="cb23-2"><a href="dplyr.html#cb23-2" aria-hidden="true" tabindex="-1"></a>mtcars_copy[, <span class="fu">colSums</span>(<span class="fu">is.na</span>(mtcars_copy)) <span class="sc">==</span> <span class="dv">0</span>]</span></code></pre></div>
<pre><code>##                      mpg  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4           21.0 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag       21.0 160.0 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710          22.8 108.0  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive      21.4 258.0 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout   18.7 360.0 175 3.15 3.440 17.02  0  0    3    2
## Valiant             18.1 225.0 105 2.76 3.460 20.22  1  0    3    1
## Duster 360          14.3 360.0 245 3.21 3.570 15.84  0  0    3    4
## Merc 240D           24.4 146.7  62 3.69 3.190 20.00  1  0    4    2
## Merc 230            22.8 140.8  95 3.92 3.150 22.90  1  0    4    2
## Merc 280            19.2 167.6 123 3.92 3.440 18.30  1  0    4    4
## Merc 280C           17.8 167.6 123 3.92 3.440 18.90  1  0    4    4
## Merc 450SE          16.4 275.8 180 3.07 4.070 17.40  0  0    3    3
## Merc 450SL          17.3 275.8 180 3.07 3.730 17.60  0  0    3    3
## Merc 450SLC         15.2 275.8 180 3.07 3.780 18.00  0  0    3    3
## Cadillac Fleetwood  10.4 472.0 205 2.93 5.250 17.98  0  0    3    4
## Lincoln Continental 10.4 460.0 215 3.00 5.424 17.82  0  0    3    4
## Chrysler Imperial   14.7 440.0 230 3.23 5.345 17.42  0  0    3    4
## Fiat 128            32.4  78.7  66 4.08 2.200 19.47  1  1    4    1
## Honda Civic         30.4  75.7  52 4.93 1.615 18.52  1  1    4    2
## Toyota Corolla      33.9  71.1  65 4.22 1.835 19.90  1  1    4    1
## Toyota Corona       21.5 120.1  97 3.70 2.465 20.01  1  0    3    1
## Dodge Challenger    15.5 318.0 150 2.76 3.520 16.87  0  0    3    2
## AMC Javelin         15.2 304.0 150 3.15 3.435 17.30  0  0    3    2
## Camaro Z28          13.3 350.0 245 3.73 3.840 15.41  0  0    3    4
## Pontiac Firebird    19.2 400.0 175 3.08 3.845 17.05  0  0    3    2
## Fiat X1-9           27.3  79.0  66 4.08 1.935 18.90  1  1    4    1
## Porsche 914-2       26.0 120.3  91 4.43 2.140 16.70  0  1    5    2
## Lotus Europa        30.4  95.1 113 3.77 1.513 16.90  1  1    5    2
## Ford Pantera L      15.8 351.0 264 4.22 3.170 14.50  0  1    5    4
## Ferrari Dino        19.7 145.0 175 3.62 2.770 15.50  0  1    5    6
## Maserati Bora       15.0 301.0 335 3.54 3.570 14.60  0  1    5    8
## Volvo 142E          21.4 121.0 109 4.11 2.780 18.60  1  1    4    2</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="dplyr.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. apply</span></span>
<span id="cb25-2"><a href="dplyr.html#cb25-2" aria-hidden="true" tabindex="-1"></a>mtcars_copy[, <span class="fu">apply</span>(mtcars_copy, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)) <span class="sc">==</span> <span class="dv">0</span>)]</span></code></pre></div>
<pre><code>##                      mpg  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4           21.0 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag       21.0 160.0 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710          22.8 108.0  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive      21.4 258.0 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout   18.7 360.0 175 3.15 3.440 17.02  0  0    3    2
## Valiant             18.1 225.0 105 2.76 3.460 20.22  1  0    3    1
## Duster 360          14.3 360.0 245 3.21 3.570 15.84  0  0    3    4
## Merc 240D           24.4 146.7  62 3.69 3.190 20.00  1  0    4    2
## Merc 230            22.8 140.8  95 3.92 3.150 22.90  1  0    4    2
## Merc 280            19.2 167.6 123 3.92 3.440 18.30  1  0    4    4
## Merc 280C           17.8 167.6 123 3.92 3.440 18.90  1  0    4    4
## Merc 450SE          16.4 275.8 180 3.07 4.070 17.40  0  0    3    3
## Merc 450SL          17.3 275.8 180 3.07 3.730 17.60  0  0    3    3
## Merc 450SLC         15.2 275.8 180 3.07 3.780 18.00  0  0    3    3
## Cadillac Fleetwood  10.4 472.0 205 2.93 5.250 17.98  0  0    3    4
## Lincoln Continental 10.4 460.0 215 3.00 5.424 17.82  0  0    3    4
## Chrysler Imperial   14.7 440.0 230 3.23 5.345 17.42  0  0    3    4
## Fiat 128            32.4  78.7  66 4.08 2.200 19.47  1  1    4    1
## Honda Civic         30.4  75.7  52 4.93 1.615 18.52  1  1    4    2
## Toyota Corolla      33.9  71.1  65 4.22 1.835 19.90  1  1    4    1
## Toyota Corona       21.5 120.1  97 3.70 2.465 20.01  1  0    3    1
## Dodge Challenger    15.5 318.0 150 2.76 3.520 16.87  0  0    3    2
## AMC Javelin         15.2 304.0 150 3.15 3.435 17.30  0  0    3    2
## Camaro Z28          13.3 350.0 245 3.73 3.840 15.41  0  0    3    4
## Pontiac Firebird    19.2 400.0 175 3.08 3.845 17.05  0  0    3    2
## Fiat X1-9           27.3  79.0  66 4.08 1.935 18.90  1  1    4    1
## Porsche 914-2       26.0 120.3  91 4.43 2.140 16.70  0  1    5    2
## Lotus Europa        30.4  95.1 113 3.77 1.513 16.90  1  1    5    2
## Ford Pantera L      15.8 351.0 264 4.22 3.170 14.50  0  1    5    4
## Ferrari Dino        19.7 145.0 175 3.62 2.770 15.50  0  1    5    6
## Maserati Bora       15.0 301.0 335 3.54 3.570 14.60  0  1    5    8
## Volvo 142E          21.4 121.0 109 4.11 2.780 18.60  1  1    4    2</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="dplyr.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using any</span></span>
<span id="cb27-2"><a href="dplyr.html#cb27-2" aria-hidden="true" tabindex="-1"></a>mtcars_copy[, <span class="fu">apply</span>(mtcars_copy, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="sc">!</span><span class="fu">any</span>(<span class="fu">is.na</span>(x)))]</span></code></pre></div>
<pre><code>##                      mpg  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4           21.0 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag       21.0 160.0 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710          22.8 108.0  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive      21.4 258.0 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout   18.7 360.0 175 3.15 3.440 17.02  0  0    3    2
## Valiant             18.1 225.0 105 2.76 3.460 20.22  1  0    3    1
## Duster 360          14.3 360.0 245 3.21 3.570 15.84  0  0    3    4
## Merc 240D           24.4 146.7  62 3.69 3.190 20.00  1  0    4    2
## Merc 230            22.8 140.8  95 3.92 3.150 22.90  1  0    4    2
## Merc 280            19.2 167.6 123 3.92 3.440 18.30  1  0    4    4
## Merc 280C           17.8 167.6 123 3.92 3.440 18.90  1  0    4    4
## Merc 450SE          16.4 275.8 180 3.07 4.070 17.40  0  0    3    3
## Merc 450SL          17.3 275.8 180 3.07 3.730 17.60  0  0    3    3
## Merc 450SLC         15.2 275.8 180 3.07 3.780 18.00  0  0    3    3
## Cadillac Fleetwood  10.4 472.0 205 2.93 5.250 17.98  0  0    3    4
## Lincoln Continental 10.4 460.0 215 3.00 5.424 17.82  0  0    3    4
## Chrysler Imperial   14.7 440.0 230 3.23 5.345 17.42  0  0    3    4
## Fiat 128            32.4  78.7  66 4.08 2.200 19.47  1  1    4    1
## Honda Civic         30.4  75.7  52 4.93 1.615 18.52  1  1    4    2
## Toyota Corolla      33.9  71.1  65 4.22 1.835 19.90  1  1    4    1
## Toyota Corona       21.5 120.1  97 3.70 2.465 20.01  1  0    3    1
## Dodge Challenger    15.5 318.0 150 2.76 3.520 16.87  0  0    3    2
## AMC Javelin         15.2 304.0 150 3.15 3.435 17.30  0  0    3    2
## Camaro Z28          13.3 350.0 245 3.73 3.840 15.41  0  0    3    4
## Pontiac Firebird    19.2 400.0 175 3.08 3.845 17.05  0  0    3    2
## Fiat X1-9           27.3  79.0  66 4.08 1.935 18.90  1  1    4    1
## Porsche 914-2       26.0 120.3  91 4.43 2.140 16.70  0  1    5    2
## Lotus Europa        30.4  95.1 113 3.77 1.513 16.90  1  1    5    2
## Ford Pantera L      15.8 351.0 264 4.22 3.170 14.50  0  1    5    4
## Ferrari Dino        19.7 145.0 175 3.62 2.770 15.50  0  1    5    6
## Maserati Bora       15.0 301.0 335 3.54 3.570 14.60  0  1    5    8
## Volvo 142E          21.4 121.0 109 4.11 2.780 18.60  1  1    4    2</code></pre>
</div>
<div id="selecting-columns-if-the-mean-is" class="section level3 hasAnchor" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Selecting Columns if the mean is &gt; …<a href="dplyr.html#selecting-columns-if-the-mean-is" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="dplyr.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add a string column</span></span>
<span id="cb29-2"><a href="dplyr.html#cb29-2" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="st">&quot;string&quot;</span>] <span class="ot">=</span> <span class="st">&quot;a&quot;</span></span>
<span id="cb29-3"><a href="dplyr.html#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="dplyr.html#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># select only string columns or numeric ones with a mean &gt; 10</span></span>
<span id="cb29-5"><a href="dplyr.html#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="dplyr.html#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Should both work!!</span></span>
<span id="cb29-7"><a href="dplyr.html#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="dplyr.html#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co"># mtcars %&gt;% </span></span>
<span id="cb29-9"><a href="dplyr.html#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   dplyr::select(</span></span>
<span id="cb29-10"><a href="dplyr.html#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     where(</span></span>
<span id="cb29-11"><a href="dplyr.html#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co">#       function(x) is.character(x) | mean(x) &gt; 10</span></span>
<span id="cb29-12"><a href="dplyr.html#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb29-13"><a href="dplyr.html#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb29-14"><a href="dplyr.html#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="dplyr.html#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="co"># mtcars %&gt;% </span></span>
<span id="cb29-16"><a href="dplyr.html#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(</span></span>
<span id="cb29-17"><a href="dplyr.html#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     where(function(x){</span></span>
<span id="cb29-18"><a href="dplyr.html#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="co">#       if(is.numeric(x)){</span></span>
<span id="cb29-19"><a href="dplyr.html#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="co">#         mean(x) &gt; 10</span></span>
<span id="cb29-20"><a href="dplyr.html#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="co">#       }else{</span></span>
<span id="cb29-21"><a href="dplyr.html#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="co">#         is.character(x) # must return true or false</span></span>
<span id="cb29-22"><a href="dplyr.html#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="co">#       }</span></span>
<span id="cb29-23"><a href="dplyr.html#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="co">#     })</span></span>
<span id="cb29-24"><a href="dplyr.html#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span></code></pre></div>
</div>
<div id="select-columns-if-the-first-value-in-the-column-is" class="section level3 hasAnchor" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> Select Columns if the first value in the column is …<a href="dplyr.html#select-columns-if-the-first-value-in-the-column-is" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="dplyr.html#cb30-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="dplyr.html#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb30-3"><a href="dplyr.html#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">where</span>(</span>
<span id="cb30-4"><a href="dplyr.html#cb30-4" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(x)x[[<span class="dv">1</span>]] <span class="sc">==</span> <span class="st">&quot;a&quot;</span></span>
<span id="cb30-5"><a href="dplyr.html#cb30-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-6"><a href="dplyr.html#cb30-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>##                     string
## Mazda RX4                a
## Mazda RX4 Wag            a
## Datsun 710               a
## Hornet 4 Drive           a
## Hornet Sportabout        a
## Valiant                  a
## Duster 360               a
## Merc 240D                a
## Merc 230                 a
## Merc 280                 a
## Merc 280C                a
## Merc 450SE               a
## Merc 450SL               a
## Merc 450SLC              a
## Cadillac Fleetwood       a
## Lincoln Continental      a
## Chrysler Imperial        a
## Fiat 128                 a
## Honda Civic              a
## Toyota Corolla           a
## Toyota Corona            a
## Dodge Challenger         a
## AMC Javelin              a
## Camaro Z28               a
## Pontiac Firebird         a
## Fiat X1-9                a
## Porsche 914-2            a
## Lotus Europa             a
## Ford Pantera L           a
## Ferrari Dino             a
## Maserati Bora            a
## Volvo 142E               a</code></pre>
</div>
</div>
<div id="filtering-rows" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Filtering Rows<a href="dplyr.html#filtering-rows" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="rowwise-compute-new-column-with-subset-of-existing-columns" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Rowwise Compute new Column with subset of existing columns<a href="dplyr.html#rowwise-compute-new-column-with-subset-of-existing-columns" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="dplyr.html#cb32-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="dplyr.html#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb32-3"><a href="dplyr.html#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">med =</span> <span class="fu">pmap_dbl</span>(<span class="fu">select</span>(., <span class="fu">where</span>(is.numeric)), <span class="sc">~</span><span class="fu">median</span>(<span class="fu">c</span>(...), <span class="at">na.rm =</span> T))</span>
<span id="cb32-4"><a href="dplyr.html#cb32-4" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">%&gt;%</span> glimpse</span></code></pre></div>
<pre><code>## Rows: 32
## Columns: 13
## $ mpg    [3m[38;5;246m&lt;dbl&gt;[39m[23m 21.0, 21.0, 22.8, 21.4, 18.7, 18.1, 14.3, 24.4, 22.8, 19.2, 17.8, 16.4, 17.3, 15.2, 10.4, 10.4, 14.7,…
## $ cyl    [3m[38;5;246m&lt;dbl&gt;[39m[23m 6, 6, 4, 6, 8, 6, 8, 4, 4, 6, 6, 8, 8, 8, 8, 8, 8, 4, 4, 4, 4, 8, 8, 8, 8, 4, 4, 4, 8, 6, 8, 4
## $ disp   [3m[38;5;246m&lt;dbl&gt;[39m[23m 160.0, 160.0, 108.0, 258.0, 360.0, 225.0, 360.0, 146.7, 140.8, 167.6, 167.6, 275.8, 275.8, 275.8, 472…
## $ hp     [3m[38;5;246m&lt;dbl&gt;[39m[23m 110, 110, 93, 110, 175, 105, 245, 62, 95, 123, 123, 180, 180, 180, 205, 215, 230, 66, 52, 65, 97, 150…
## $ drat   [3m[38;5;246m&lt;dbl&gt;[39m[23m 3.90, 3.90, 3.85, 3.08, 3.15, 2.76, 3.21, 3.69, 3.92, 3.92, 3.92, 3.07, 3.07, 3.07, 2.93, 3.00, 3.23,…
## $ wt     [3m[38;5;246m&lt;dbl&gt;[39m[23m 2.620, 2.875, 2.320, 3.215, 3.440, 3.460, 3.570, 3.190, 3.150, 3.440, 3.440, 4.070, 3.730, 3.780, 5.2…
## $ qsec   [3m[38;5;246m&lt;dbl&gt;[39m[23m 16.46, 17.02, 18.61, 19.44, 17.02, 20.22, 15.84, 20.00, 22.90, 18.30, 18.90, 17.40, 17.60, 18.00, 17.…
## $ vs     [3m[38;5;246m&lt;dbl&gt;[39m[23m 0, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1
## $ am     [3m[38;5;246m&lt;dbl&gt;[39m[23m 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1
## $ gear   [3m[38;5;246m&lt;dbl&gt;[39m[23m 4, 4, 4, 3, 3, 3, 3, 4, 4, 4, 4, 3, 3, 3, 3, 3, 3, 4, 4, 4, 3, 3, 3, 3, 3, 4, 5, 5, 5, 5, 5, 4
## $ carb   [3m[38;5;246m&lt;dbl&gt;[39m[23m 4, 4, 1, 1, 2, 1, 4, 2, 2, 4, 4, 3, 3, 3, 4, 4, 4, 1, 2, 1, 1, 2, 2, 4, 2, 1, 2, 2, 4, 6, 8, 2
## $ string [3m[38;5;246m&lt;chr&gt;[39m[23m &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;…
## $ med    [3m[38;5;246m&lt;dbl&gt;[39m[23m 4.000, 4.000, 4.000, 3.215, 3.440, 3.460, 4.000, 4.000, 4.000, 4.000, 4.000, 4.070, 3.730, 3.780, 5.2…</code></pre>
</div>
<div id="adding-column-indicating-if-group-if-max-value-in-group-is-in-top-n-max-values-per-group" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Adding column indicating if group if max value in group is in top-n max values per group<a href="dplyr.html#adding-column-indicating-if-group-if-max-value-in-group-is-in-top-n-max-values-per-group" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Steps: </strong></p>
<ol style="list-style-type: decimal">
<li><p><code>group_by</code> the grouping variable</p></li>
<li><p>summarise get the max value per group</p></li>
<li><p><code>inneer_join</code> the result with the original data-frame</p></li>
</ol>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="dplyr.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># which of the cyl-groups  contains the two highest disp</span></span>
<span id="cb34-2"><a href="dplyr.html#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="dplyr.html#cb34-3" aria-hidden="true" tabindex="-1"></a>top12 <span class="ot">=</span> mtcars <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="dplyr.html#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span></span>
<span id="cb34-5"><a href="dplyr.html#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">m =</span> <span class="fu">max</span>(disp)) <span class="sc">%&gt;%</span></span>
<span id="cb34-6"><a href="dplyr.html#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(m)) <span class="sc">%&gt;%</span></span>
<span id="cb34-7"><a href="dplyr.html#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-8"><a href="dplyr.html#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">top2 =</span> <span class="fu">if_else</span>(<span class="fu">row_number</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), T, F)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-9"><a href="dplyr.html#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb34-10"><a href="dplyr.html#cb34-10" aria-hidden="true" tabindex="-1"></a>    ., mtcars, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;cyl&quot;</span>)</span>
<span id="cb34-11"><a href="dplyr.html#cb34-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div id="example-of-stackoverflow" class="section level5 hasAnchor" number="4.6.0.0.1">
<h5><span class="header-section-number">4.6.0.0.1</span> example of STACKOVERFLOW<a href="dplyr.html#example-of-stackoverflow" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="dplyr.html#cb35-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">structure</span>(<span class="fu">list</span>(<span class="at">id =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, </span>
<span id="cb35-2"><a href="dplyr.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, </span>
<span id="cb35-3"><a href="dplyr.html#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>, </span>
<span id="cb35-4"><a href="dplyr.html#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, </span>
<span id="cb35-5"><a href="dplyr.html#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">9</span>, <span class="dv">9</span>, <span class="dv">9</span>, <span class="dv">9</span>, <span class="dv">9</span>, <span class="dv">9</span>, <span class="dv">9</span>, <span class="dv">9</span>, <span class="dv">9</span>), <span class="at">year =</span> <span class="fu">c</span>(<span class="st">&quot;2017&quot;</span>, <span class="st">&quot;2018&quot;</span>, </span>
<span id="cb35-6"><a href="dplyr.html#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;2019&quot;</span>, <span class="st">&quot;2020&quot;</span>, <span class="st">&quot;2021&quot;</span>, <span class="st">&quot;2022&quot;</span>, <span class="st">&quot;2023&quot;</span>, <span class="st">&quot;2024&quot;</span>, <span class="st">&quot;2025&quot;</span>, <span class="st">&quot;2026&quot;</span>, </span>
<span id="cb35-7"><a href="dplyr.html#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;2017&quot;</span>, <span class="st">&quot;2018&quot;</span>, <span class="st">&quot;2019&quot;</span>, <span class="st">&quot;2020&quot;</span>, <span class="st">&quot;2021&quot;</span>, <span class="st">&quot;2022&quot;</span>, <span class="st">&quot;2023&quot;</span>, <span class="st">&quot;2024&quot;</span>, </span>
<span id="cb35-8"><a href="dplyr.html#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;2025&quot;</span>, <span class="st">&quot;2026&quot;</span>, <span class="st">&quot;2017&quot;</span>, <span class="st">&quot;2018&quot;</span>, <span class="st">&quot;2019&quot;</span>, <span class="st">&quot;2020&quot;</span>, <span class="st">&quot;2021&quot;</span>, <span class="st">&quot;2022&quot;</span>, </span>
<span id="cb35-9"><a href="dplyr.html#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;2023&quot;</span>, <span class="st">&quot;2024&quot;</span>, <span class="st">&quot;2025&quot;</span>, <span class="st">&quot;2026&quot;</span>, <span class="st">&quot;2017&quot;</span>, <span class="st">&quot;2018&quot;</span>, <span class="st">&quot;2019&quot;</span>, <span class="st">&quot;2020&quot;</span>, </span>
<span id="cb35-10"><a href="dplyr.html#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;2021&quot;</span>, <span class="st">&quot;2022&quot;</span>, <span class="st">&quot;2023&quot;</span>, <span class="st">&quot;2024&quot;</span>, <span class="st">&quot;2025&quot;</span>, <span class="st">&quot;2026&quot;</span>, <span class="st">&quot;2017&quot;</span>, <span class="st">&quot;2018&quot;</span>, </span>
<span id="cb35-11"><a href="dplyr.html#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;2019&quot;</span>, <span class="st">&quot;2020&quot;</span>, <span class="st">&quot;2021&quot;</span>, <span class="st">&quot;2022&quot;</span>, <span class="st">&quot;2023&quot;</span>, <span class="st">&quot;2024&quot;</span>, <span class="st">&quot;2025&quot;</span>, <span class="st">&quot;2026&quot;</span>, </span>
<span id="cb35-12"><a href="dplyr.html#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;2017&quot;</span>, <span class="st">&quot;2018&quot;</span>, <span class="st">&quot;2019&quot;</span>, <span class="st">&quot;2020&quot;</span>, <span class="st">&quot;2021&quot;</span>, <span class="st">&quot;2022&quot;</span>, <span class="st">&quot;2023&quot;</span>, <span class="st">&quot;2024&quot;</span>, </span>
<span id="cb35-13"><a href="dplyr.html#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;2025&quot;</span>, <span class="st">&quot;2026&quot;</span>, <span class="st">&quot;2017&quot;</span>, <span class="st">&quot;2018&quot;</span>, <span class="st">&quot;2019&quot;</span>, <span class="st">&quot;2020&quot;</span>, <span class="st">&quot;2021&quot;</span>, <span class="st">&quot;2022&quot;</span>, </span>
<span id="cb35-14"><a href="dplyr.html#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;2023&quot;</span>, <span class="st">&quot;2024&quot;</span>, <span class="st">&quot;2025&quot;</span>, <span class="st">&quot;2026&quot;</span>, <span class="st">&quot;2017&quot;</span>, <span class="st">&quot;2018&quot;</span>, <span class="st">&quot;2019&quot;</span>, <span class="st">&quot;2020&quot;</span>, </span>
<span id="cb35-15"><a href="dplyr.html#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;2021&quot;</span>, <span class="st">&quot;2022&quot;</span>, <span class="st">&quot;2023&quot;</span>, <span class="st">&quot;2024&quot;</span>, <span class="st">&quot;2025&quot;</span>, <span class="st">&quot;2026&quot;</span>, <span class="st">&quot;2017&quot;</span>, <span class="st">&quot;2018&quot;</span>, </span>
<span id="cb35-16"><a href="dplyr.html#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;2019&quot;</span>, <span class="st">&quot;2020&quot;</span>, <span class="st">&quot;2021&quot;</span>, <span class="st">&quot;2022&quot;</span>, <span class="st">&quot;2023&quot;</span>, <span class="st">&quot;2024&quot;</span>, <span class="st">&quot;2025&quot;</span>, <span class="st">&quot;2026&quot;</span></span>
<span id="cb35-17"><a href="dplyr.html#cb35-17" aria-hidden="true" tabindex="-1"></a>), <span class="at">volume =</span> <span class="fu">c</span>(<span class="fl">0.0013</span>, <span class="fl">0.0013</span>, <span class="fl">0.0012579</span>, <span class="fl">0.0011895</span>, <span class="fl">0.0011421</span>, </span>
<span id="cb35-18"><a href="dplyr.html#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="fl">0.0010842</span>, <span class="fl">0.0010211</span>, <span class="fl">0.0010158</span>, <span class="fl">0.00099474</span>, <span class="fl">0.00092632</span>, <span class="fl">0.07878</span>, </span>
<span id="cb35-19"><a href="dplyr.html#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="fl">0.078791</span>, <span class="fl">0.077295</span>, <span class="fl">0.076638</span>, <span class="fl">0.075538</span>, <span class="fl">0.074468</span>, <span class="fl">0.074776</span>, <span class="fl">0.074051</span>, </span>
<span id="cb35-20"><a href="dplyr.html#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="fl">0.071706</span>, <span class="fl">0.068056</span>, <span class="fl">0.023269</span>, <span class="fl">0.023011</span>, <span class="fl">0.022374</span>, <span class="fl">0.021962</span>, <span class="fl">0.021408</span>, </span>
<span id="cb35-21"><a href="dplyr.html#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="fl">0.020949</span>, <span class="fl">0.020811</span>, <span class="fl">0.020354</span>, <span class="fl">0.019309</span>, <span class="fl">0.018042</span>, <span class="fl">0.0004</span>, <span class="fl">0.0004</span>, </span>
<span id="cb35-22"><a href="dplyr.html#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="fl">0.00038421</span>, <span class="fl">0.00035263</span>, <span class="fl">0.00033158</span>, <span class="fl">0.00032105</span>, <span class="fl">0.00026842</span>, <span class="fl">0.00028421</span>, </span>
<span id="cb35-23"><a href="dplyr.html#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="fl">0.00026842</span>, <span class="fl">0.00024211</span>, <span class="fl">0.0002</span>, <span class="fl">0.0001</span>, <span class="fl">0.00011579</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, </span>
<span id="cb35-24"><a href="dplyr.html#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.028422</span>, <span class="fl">0.028361</span>, <span class="fl">0.027768</span>, <span class="fl">0.027501</span>, <span class="fl">0.027029</span>, </span>
<span id="cb35-25"><a href="dplyr.html#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="fl">0.02651</span>, <span class="fl">0.026588</span>, <span class="fl">0.026209</span>, <span class="fl">0.025094</span>, <span class="fl">0.023391</span>, <span class="fl">0.0001</span>, <span class="fl">0.0001</span>, </span>
<span id="cb35-26"><a href="dplyr.html#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.0047</span>, <span class="fl">0.0047158</span>, <span class="fl">0.0048368</span>, <span class="fl">0.0048316</span>, </span>
<span id="cb35-27"><a href="dplyr.html#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="fl">0.0049263</span>, <span class="fl">0.0049737</span>, <span class="fl">0.0049947</span>, <span class="fl">0.0051684</span>, <span class="fl">0.0052526</span>, <span class="fl">0.0051842</span>, </span>
<span id="cb35-28"><a href="dplyr.html#cb35-28" aria-hidden="true" tabindex="-1"></a><span class="fl">0.0106</span>, <span class="fl">0.010389</span>, <span class="fl">0.010279</span>, <span class="fl">0.010005</span>, <span class="fl">0.0098421</span>, <span class="fl">0.0096368</span>, <span class="fl">0.0094053</span>, </span>
<span id="cb35-29"><a href="dplyr.html#cb35-29" aria-hidden="true" tabindex="-1"></a><span class="fl">0.0093368</span>, <span class="fl">0.0092526</span>, <span class="fl">0.0089316</span>)), <span class="at">class =</span> <span class="fu">c</span>(<span class="st">&quot;tbl_df&quot;</span>, <span class="st">&quot;tbl&quot;</span>, </span>
<span id="cb35-30"><a href="dplyr.html#cb35-30" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;data.frame&quot;</span>), <span class="at">row.names =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="sc">-</span>90L))</span>
<span id="cb35-31"><a href="dplyr.html#cb35-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-32"><a href="dplyr.html#cb35-32" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb35-33"><a href="dplyr.html#cb35-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb35-34"><a href="dplyr.html#cb35-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">m =</span> <span class="fu">max</span>(volume)) <span class="sc">%&gt;%</span></span>
<span id="cb35-35"><a href="dplyr.html#cb35-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(m)) <span class="sc">%&gt;%</span></span>
<span id="cb35-36"><a href="dplyr.html#cb35-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">top3 =</span> <span class="fu">if_else</span>(<span class="fu">row_number</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), T, F)) <span class="sc">%&gt;%</span></span>
<span id="cb35-37"><a href="dplyr.html#cb35-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(., df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;id&quot;</span>)) <span class="ot">-&gt;</span> top123</span></code></pre></div>
</div>
</div>
<div id="list-columns-and-dplyr" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> list Columns (and <code>dplyr</code>)<a href="dplyr.html#list-columns-and-dplyr" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>tibbles and dataframes are lists of vectors!!</li>
</ul>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="dplyr.html#cb36-1" aria-hidden="true" tabindex="-1"></a>l <span class="ot">=</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">runif</span>(<span class="dv">10</span>),</span>
<span id="cb36-2"><a href="dplyr.html#cb36-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb36-3"><a href="dplyr.html#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="dplyr.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(l)</span></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<p><img src="images/tibble.png" />
<a href="https://dcl-prog.stanford.edu/list-columns.html">image source:</a></p>
<ul>
<li>Meaning each column is a vector. Usually these are atomic vectors (recall chapter .. TODO in advanced R..), but these can also be lists.</li>
</ul>
<p><img src="images/tibble-list-col.png" />
<a href="https://dcl-prog.stanford.edu/list-columns.html">image source:</a></p>
<ul>
<li>List columns are much more versatile than atomic vectors. They can contain atomic vectors, other lists, tibbles, …</li>
</ul>
<div id="creating-list-columns" class="section level3 hasAnchor" number="4.7.1">
<h3><span class="header-section-number">4.7.1</span> Creating List Columns<a href="dplyr.html#creating-list-columns" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>It seems to be common to create list columns by modifying an existing “normal” tibble. Three common ways are:</p>
<ul>
<li><code>nest()</code></li>
<li><code>summarise</code> and <code>list</code></li>
<li><code>mutate</code> and <code>map</code></li>
</ul></li>
</ul>
<div id="nest" class="section level4 hasAnchor" number="4.7.1.1">
<h4><span class="header-section-number">4.7.1.1</span> <code>nest()</code><a href="dplyr.html#nest" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>When calling <code>nest</code> the first argument is the new column-name. In this case it is <code>cars</code>.</p></li>
<li><p>The second argument are the columns you want to have in the resulting dataframe in each element of the list column.</p></li>
<li><p>Each column you do not specify automatically becomes a <em>grouping variable</em> and all the resulting tibble will have as many rows as unique combinations in these <em>grouping variables</em> there are.</p></li>
</ul>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="dplyr.html#cb38-1" aria-hidden="true" tabindex="-1"></a>mtcars_with_list_col <span class="ot">=</span> mtcars <span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="dplyr.html#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="dplyr.html#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cyl, mpg, name) <span class="sc">%&gt;%</span></span>
<span id="cb38-4"><a href="dplyr.html#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">cars =</span> <span class="fu">c</span>(mpg, name))</span>
<span id="cb38-5"><a href="dplyr.html#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="dplyr.html#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect it</span></span>
<span id="cb38-7"><a href="dplyr.html#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mtcars_with_list_col)</span></code></pre></div>
<pre><code>## tibble [3 × 2] (S3: tbl_df/tbl/data.frame)
##  $ cyl : num [1:3] 6 4 8
##  $ cars:List of 3
##   ..$ : tibble [7 × 2] (S3: tbl_df/tbl/data.frame)
##   .. ..$ mpg : num [1:7] 21 21 21.4 18.1 19.2 17.8 19.7
##   .. ..$ name: chr [1:7] &quot;Mazda RX4&quot; &quot;Mazda RX4 Wag&quot; &quot;Hornet 4 Drive&quot; &quot;Valiant&quot; ...
##   ..$ : tibble [11 × 2] (S3: tbl_df/tbl/data.frame)
##   .. ..$ mpg : num [1:11] 22.8 24.4 22.8 32.4 30.4 33.9 21.5 27.3 26 30.4 ...
##   .. ..$ name: chr [1:11] &quot;Datsun 710&quot; &quot;Merc 240D&quot; &quot;Merc 230&quot; &quot;Fiat 128&quot; ...
##   ..$ : tibble [14 × 2] (S3: tbl_df/tbl/data.frame)
##   .. ..$ mpg : num [1:14] 18.7 14.3 16.4 17.3 15.2 10.4 10.4 14.7 15.5 15.2 ...
##   .. ..$ name: chr [1:14] &quot;Hornet Sportabout&quot; &quot;Duster 360&quot; &quot;Merc 450SE&quot; &quot;Merc 450SL&quot; ...</code></pre>
</div>
<div id="summarise-and-list" class="section level4 hasAnchor" number="4.7.1.2">
<h4><span class="header-section-number">4.7.1.2</span> <code>summarise</code> and <code>list</code><a href="dplyr.html#summarise-and-list" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>Normally you use <code>group_by</code> and <code>summarise</code> to collapse groups into single rows.</p></li>
<li><p>You can also use <code>group_by</code>, <code>summarise</code> and <code>list</code> to create atomic vectors where each vector corresponds to one group of <code>cyl</code></p></li>
</ul>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="dplyr.html#cb40-1" aria-hidden="true" tabindex="-1"></a>mtcars_names_per_cyl <span class="ot">=</span> mtcars <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="dplyr.html#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="dplyr.html#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="dplyr.html#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cars_per_cyl =</span> <span class="fu">list</span>(name))</span></code></pre></div>
<ul>
<li>What if you want to manipulate each vector before putting it into the list column</li>
</ul>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="dplyr.html#cb41-1" aria-hidden="true" tabindex="-1"></a>mtcars_names_per_cyl_sorted <span class="ot">=</span> mtcars <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="dplyr.html#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="dplyr.html#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span></span>
<span id="cb41-4"><a href="dplyr.html#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cars_per_cyl =</span> <span class="fu">list</span>(<span class="fu">sort</span>(name)))</span></code></pre></div>
</div>
<div id="mutate-and-map" class="section level4 hasAnchor" number="4.7.1.3">
<h4><span class="header-section-number">4.7.1.3</span> <code>mutate</code> and <code>map</code><a href="dplyr.html#mutate-and-map" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="dplyr.html#cb42-1" aria-hidden="true" tabindex="-1"></a>n_values_per_car_letter <span class="ot">=</span> mtcars <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="dplyr.html#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="dplyr.html#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">random =</span> <span class="fu">map</span>(name, <span class="sc">~</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">str_length</span>(.x)))) <span class="sc">%&gt;%</span></span>
<span id="cb42-4"><a href="dplyr.html#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, random)</span>
<span id="cb42-5"><a href="dplyr.html#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="dplyr.html#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(n_values_per_car_letter)  </span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    32 obs. of  2 variables:
##  $ name  : chr  &quot;Mazda RX4&quot; &quot;Mazda RX4 Wag&quot; &quot;Datsun 710&quot; &quot;Hornet 4 Drive&quot; ...
##  $ random:List of 32
##   ..$ : num  -1.55965 -0.36433 -0.00423 0.94024 1.67223 ...
##   ..$ : num  0.6224 -1.1962 -2.3067 1.9585 -0.0843 ...
##   ..$ : num  0.131 0.443 0.04 -0.402 0.827 ...
##   ..$ : num  0.61 0.63 1.036 0.457 -0.705 ...
##   ..$ : num  1.0089 -0.0704 0.893 -0.2866 -0.1931 ...
##   ..$ : num  0.545 1.099 1.729 0.137 0.198 ...
##   ..$ : num  0.4992 -0.241 -1.3455 0.0906 -1.2542 ...
##   ..$ : num  -0.283 -1.63 1.127 1.561 0.161 ...
##   ..$ : num  -0.531 0.182 -0.577 0.102 -0.597 ...
##   ..$ : num  -0.135 -0.562 0.823 -0.177 1.02 ...
##   ..$ : num  -2.242 -0.2 0.229 -1.424 1.935 ...
##   ..$ : num  -2.133 -1.306 2.147 -2.203 -0.506 ...
##   ..$ : num  -0.54 0.885 -0.271 0.146 0.295 ...
##   ..$ : num  -0.147 -0.758 0.111 -2.188 -1.237 ...
##   ..$ : num  0.00676 -0.28968 -0.90222 -0.9335 1.76382 ...
##   ..$ : num  -0.325 0.537 -0.857 0.106 -0.281 ...
##   ..$ : num  0.2582 0.9811 2.1431 -0.0967 0.3572 ...
##   ..$ : num  -0.41 0.189 -1.44 -1.578 -0.831 ...
##   ..$ : num  -0.673 -1.012 -1.768 1.499 -0.14 ...
##   ..$ : num  0.0209 -0.779 0.2796 1.4111 -0.4292 ...
##   ..$ : num  -0.0844 1.5062 -1.2214 -1.1946 1.0583 ...
##   ..$ : num  0.176 -2.277 -0.534 -0.552 -0.884 ...
##   ..$ : num  -0.371 0.209 1.276 0.677 -1.426 ...
##   ..$ : num  -0.772 -0.484 -0.215 0.605 -0.736 ...
##   ..$ : num  -0.0464 0.5238 -0.6053 -1.3328 1.0591 ...
##   ..$ : num  1.473 1.63 -1.797 0.272 1.187 ...
##   ..$ : num  0.6818 0.1851 -0.0193 -1.2157 -0.504 ...
##   ..$ : num  -0.702 -1.418 0.134 -0.399 2.088 ...
##   ..$ : num  0.265 -1.208 0.345 -0.655 -0.177 ...
##   ..$ : num  -1.685 -1.441 -1.196 0.893 -0.499 ...
##   ..$ : num  -0.514 0.126 1.778 -0.219 0.758 ...
##   ..$ : num  -0.0634 -0.4908 -0.7768 0.4533 -1.7318 ...</code></pre>
</div>
</div>
<div id="manipulating" class="section level3 hasAnchor" number="4.7.2">
<h3><span class="header-section-number">4.7.2</span> Manipulating<a href="dplyr.html#manipulating" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>say you want to get the number of rows for each data.frame in a list column</li>
</ul>
<p><strong>Version 1</strong></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="dplyr.html#cb44-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="dplyr.html#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="dplyr.html#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">data_per_cyl =</span> <span class="sc">!</span>cyl) <span class="sc">%&gt;%</span> </span>
<span id="cb44-4"><a href="dplyr.html#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb44-5"><a href="dplyr.html#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow_per_cyl =</span> <span class="fu">map_dbl</span>(data_per_cyl, nrow)</span>
<span id="cb44-6"><a href="dplyr.html#cb44-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##     cyl data_per_cyl       nrow_per_cyl
##   &lt;dbl&gt; &lt;list&gt;                    &lt;dbl&gt;
## 1     6 &lt;tibble [7 × 12]&gt;             7
## 2     4 &lt;tibble [11 × 12]&gt;           11
## 3     8 &lt;tibble [14 × 12]&gt;           14</code></pre>
<p><strong>Version 2</strong></p>
<ul>
<li>usig <code>rowwise</code></li>
</ul>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="dplyr.html#cb46-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="dplyr.html#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="dplyr.html#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">data_per_cyl =</span> <span class="sc">!</span>cyl) <span class="sc">%&gt;%</span> </span>
<span id="cb46-4"><a href="dplyr.html#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb46-5"><a href="dplyr.html#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb46-6"><a href="dplyr.html#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow_per_cyl =</span> <span class="fu">nrow</span>(data_per_cyl)</span>
<span id="cb46-7"><a href="dplyr.html#cb46-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
## # Rowwise: 
##     cyl data_per_cyl       nrow_per_cyl
##   &lt;dbl&gt; &lt;list&gt;                    &lt;int&gt;
## 1     6 &lt;tibble [7 × 12]&gt;             7
## 2     4 &lt;tibble [11 × 12]&gt;           11
## 3     8 &lt;tibble [14 × 12]&gt;           14</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-types.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="mapping.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/03-dplyr.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection",
"toc_depth": 3
}
});
});
</script>

</body>

</html>
