<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Make my life easy with R - 3&nbsp; Dplyr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./mapping.html" rel="next">
<link href="./datatypes.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./dplyr.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Dplyr</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Make my life easy with R</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Index</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datatypes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Types</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dplyr.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Dplyr</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Mapping</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ggplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Ggplot</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">SF</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#ressources" id="toc-ressources" class="nav-link active" data-scroll-target="#ressources"><span class="header-section-number">3.1</span> Ressources</a></li>
  <li><a href="#what-is-tidy-select" id="toc-what-is-tidy-select" class="nav-link" data-scroll-target="#what-is-tidy-select"><span class="header-section-number">3.2</span> What is <code>tidy-select</code></a></li>
  <li><a href="#selecting-columns" id="toc-selecting-columns" class="nav-link" data-scroll-target="#selecting-columns"><span class="header-section-number">3.3</span> Selecting columns</a>
  <ul>
  <li><a href="#selecting-columns-based-on-regex" id="toc-selecting-columns-based-on-regex" class="nav-link" data-scroll-target="#selecting-columns-based-on-regex"><span class="header-section-number">3.3.1</span> Selecting columns based on regex</a></li>
  <li><a href="#selecting-columns-based-if-any-value-in-the-column-is-na" id="toc-selecting-columns-based-if-any-value-in-the-column-is-na" class="nav-link" data-scroll-target="#selecting-columns-based-if-any-value-in-the-column-is-na"><span class="header-section-number">3.3.2</span> Selecting Columns based if any value in the column is <code>na</code></a></li>
  <li><a href="#selecting-columns-if-the-mean-is-above-ten-or-it-is-a-numeric-column" id="toc-selecting-columns-if-the-mean-is-above-ten-or-it-is-a-numeric-column" class="nav-link" data-scroll-target="#selecting-columns-if-the-mean-is-above-ten-or-it-is-a-numeric-column"><span class="header-section-number">3.3.3</span> Selecting Columns if the mean is above ten or it is a numeric column</a></li>
  <li><a href="#select-columns-if-the-first-value-in-the-column-is" id="toc-select-columns-if-the-first-value-in-the-column-is" class="nav-link" data-scroll-target="#select-columns-if-the-first-value-in-the-column-is"><span class="header-section-number">3.3.4</span> Select Columns if the first value in the column is …</a></li>
  <li><a href="#where-vs-normal-tidy-select" id="toc-where-vs-normal-tidy-select" class="nav-link" data-scroll-target="#where-vs-normal-tidy-select"><span class="header-section-number">3.3.5</span> where vs “normal” tidy select</a></li>
  </ul></li>
  <li><a href="#filtering-rows" id="toc-filtering-rows" class="nav-link" data-scroll-target="#filtering-rows"><span class="header-section-number">3.4</span> Filtering Rows</a></li>
  <li><a href="#adding-new-columns" id="toc-adding-new-columns" class="nav-link" data-scroll-target="#adding-new-columns"><span class="header-section-number">3.5</span> Adding new Columns</a>
  <ul>
  <li><a href="#rowwise-compute-value-for-new-column-with-subset-of-existing-columns" id="toc-rowwise-compute-value-for-new-column-with-subset-of-existing-columns" class="nav-link" data-scroll-target="#rowwise-compute-value-for-new-column-with-subset-of-existing-columns"><span class="header-section-number">3.5.1</span> Rowwise Compute value for new column with subset of existing columns</a></li>
  </ul></li>
  <li><a href="#adding-column-indicating-if-group-if-max-value-in-group-is-in-top-n-max-values-per-group" id="toc-adding-column-indicating-if-group-if-max-value-in-group-is-in-top-n-max-values-per-group" class="nav-link" data-scroll-target="#adding-column-indicating-if-group-if-max-value-in-group-is-in-top-n-max-values-per-group"><span class="header-section-number">3.6</span> Adding column indicating if group if max value in group is in top-n max values per group</a></li>
  <li><a href="#list-columns-and-dplyr" id="toc-list-columns-and-dplyr" class="nav-link" data-scroll-target="#list-columns-and-dplyr"><span class="header-section-number">3.7</span> list Columns (and <code>dplyr</code>)</a>
  <ul>
  <li><a href="#creating-list-columns" id="toc-creating-list-columns" class="nav-link" data-scroll-target="#creating-list-columns"><span class="header-section-number">3.7.1</span> Creating List Columns</a>
  <ul class="collapse">
  <li><a href="#nest" id="toc-nest" class="nav-link" data-scroll-target="#nest"><span class="header-section-number">3.7.1.1</span> <code>nest()</code></a></li>
  <li><a href="#summarise-and-list" id="toc-summarise-and-list" class="nav-link" data-scroll-target="#summarise-and-list"><span class="header-section-number">3.7.1.2</span> <code>summarise</code> and <code>list</code></a></li>
  <li><a href="#mutate-and-map" id="toc-mutate-and-map" class="nav-link" data-scroll-target="#mutate-and-map"><span class="header-section-number">3.7.1.3</span> <code>mutate</code> and <code>map</code></a></li>
  </ul></li>
  <li><a href="#manipulating" id="toc-manipulating" class="nav-link" data-scroll-target="#manipulating"><span class="header-section-number">3.7.2</span> Manipulating</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Dplyr</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="ressources" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="ressources"><span class="header-section-number">3.1</span> Ressources</h2>
</section>
<section id="what-is-tidy-select" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="what-is-tidy-select"><span class="header-section-number">3.2</span> What is <code>tidy-select</code></h2>
<ul>
<li><p><a href="https://dplyr.tidyverse.org/reference/select.html">Official docs here</a></p></li>
<li><p>In the end you always want a boolean vector that has the length of the number of columns</p></li>
</ul>
</section>
<section id="selecting-columns" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="selecting-columns"><span class="header-section-number">3.3</span> Selecting columns</h2>
<section id="selecting-columns-based-on-regex" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="selecting-columns-based-on-regex"><span class="header-section-number">3.3.1</span> Selecting columns based on regex</h3>
<ul>
<li><p><a href="https://tidyselect.r-lib.org/reference/starts_with.html">Look here</a> for all the possible helper functions.</p></li>
<li><p>If you wanna apply a regex yourself you can use the <code>matches</code>-function. However there are “helpers” e.g.&nbsp;<code>starts_with</code>…</p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select all columns with three characters</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matches</span>(<span class="st">"^[a-zA-Z]{3}$"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> head</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                   mpg cyl
Mazda RX4         21.0   6
Mazda RX4 Wag     21.0   6
Datsun 710        22.8   4
Hornet 4 Drive    21.4   6
Hornet Sportabout 18.7   8
Valiant           18.1   6</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cant use logical vector is select (e.g select(mtcars, c(TRUE, FALSE))) does not work</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Must be indexes!</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">which</span>(<span class="fu">grepl</span>(<span class="st">"^[a-zA-Z]{3}$"</span>, <span class="fu">names</span>(.)))) <span class="sc">%&gt;%</span> head</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                   mpg cyl
Mazda RX4         21.0   6
Mazda RX4 Wag     21.0   6
Datsun 710        22.8   4
Hornet 4 Drive    21.4   6
Hornet Sportabout 18.7   8
Valiant           18.1   6</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select_if can use a boolean vector!! However is superseeded</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_if</span>(<span class="fu">grepl</span>(<span class="st">"^[a-zA-Z]{3}$"</span>, <span class="fu">names</span>(.))) <span class="sc">%&gt;%</span> head</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                   mpg cyl
Mazda RX4         21.0   6
Mazda RX4 Wag     21.0   6
Datsun 710        22.8   4
Hornet 4 Drive    21.4   6
Hornet Sportabout 18.7   8
Valiant           18.1   6</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># do the same in base r</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">=</span> <span class="fu">grepl</span>(<span class="st">"^[a-zA-Z]{3}$"</span>, <span class="fu">names</span>(mtcars))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>mtcars[, idx] <span class="sc">%&gt;%</span> head</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                   mpg cyl
Mazda RX4         21.0   6
Mazda RX4 Wag     21.0   6
Datsun 710        22.8   4
Hornet 4 Drive    21.4   6
Hornet Sportabout 18.7   8
Valiant           18.1   6</code></pre>
</div>
</div>
</section>
<section id="selecting-columns-based-if-any-value-in-the-column-is-na" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="selecting-columns-based-if-any-value-in-the-column-is-na"><span class="header-section-number">3.3.2</span> Selecting Columns based if any value in the column is <code>na</code></h3>
<p><strong>Approach 1</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># setting the value in the second row and third to nineth column to na</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>mtcars_copy <span class="ot">=</span> mtcars</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>mtcars_copy[<span class="dv">2</span>,<span class="dv">3</span><span class="sc">:</span><span class="dv">9</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>mtcars_copy <span class="sc">%&gt;%</span> head</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   mpg cyl disp  hp drat    wt  qsec vs am gear carb
Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
Mazda RX4 Wag     21.0   6   NA  NA   NA    NA    NA NA NA    4    4
Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
</div>
</div>
<p><strong>1. <code>where</code>-tidyselect</strong></p>
<ul>
<li>use the tidy-select <code>where(fn)</code> function. <code>fn</code> is a function that takes an vector, in this case the entire column, as input. Can be an anonymus function!</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>mtcars_copy <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(<span class="cf">function</span>(x) {</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(<span class="fu">is.na</span>(x)) <span class="sc">==</span> <span class="dv">0</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  })) <span class="sc">%&gt;%</span> head</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                   mpg cyl gear carb
Mazda RX4         21.0   6    4    4
Mazda RX4 Wag     21.0   6    4    4
Datsun 710        22.8   4    4    1
Hornet 4 Drive    21.4   6    3    1
Hornet Sportabout 18.7   8    3    2
Valiant           18.1   6    3    1</code></pre>
</div>
</div>
<p><strong>2. `base-r colsums</strong></p>
<ul>
<li><p>use the base-r <code>colSums</code> function which takes only numeric arrays or dataframes as input</p></li>
<li><p><code>is.na(df)</code> checks for each value in the df if it is <code>NA</code>.</p></li>
<li><p>And then it implicitly is numeric as <code>false</code> = 0 and <code>true</code> = 1</p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. base r</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>mtcars_copy[, <span class="fu">colSums</span>(<span class="fu">is.na</span>(mtcars_copy)) <span class="sc">==</span> <span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                     mpg cyl gear carb
Mazda RX4           21.0   6    4    4
Mazda RX4 Wag       21.0   6    4    4
Datsun 710          22.8   4    4    1
Hornet 4 Drive      21.4   6    3    1
Hornet Sportabout   18.7   8    3    2
Valiant             18.1   6    3    1
Duster 360          14.3   8    3    4
Merc 240D           24.4   4    4    2
Merc 230            22.8   4    4    2
Merc 280            19.2   6    4    4
Merc 280C           17.8   6    4    4
Merc 450SE          16.4   8    3    3
Merc 450SL          17.3   8    3    3
Merc 450SLC         15.2   8    3    3
Cadillac Fleetwood  10.4   8    3    4
Lincoln Continental 10.4   8    3    4
Chrysler Imperial   14.7   8    3    4
Fiat 128            32.4   4    4    1
Honda Civic         30.4   4    4    2
Toyota Corolla      33.9   4    4    1
Toyota Corona       21.5   4    3    1
Dodge Challenger    15.5   8    3    2
AMC Javelin         15.2   8    3    2
Camaro Z28          13.3   8    3    4
Pontiac Firebird    19.2   8    3    2
Fiat X1-9           27.3   4    4    1
Porsche 914-2       26.0   4    5    2
Lotus Europa        30.4   4    5    2
Ford Pantera L      15.8   8    5    4
Ferrari Dino        19.7   6    5    6
Maserati Bora       15.0   8    5    8
Volvo 142E          21.4   4    4    2</code></pre>
</div>
</div>
<p><strong>3. apply</strong></p>
<ul>
<li><p>a dataframe is essentially a list of vectors. So we can iterate over it with any mapping-function like <code>apply</code> or <code>map</code></p></li>
<li><p>For the <code>MARGIN</code>-argument we set it to 2. So for the <strong>columns</strong></p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(mtcars_copy, <span class="dv">2</span>, <span class="cf">function</span>(x)<span class="fu">sum</span>(<span class="fu">is.na</span>(x)) <span class="sc">==</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb 
 TRUE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE </code></pre>
</div>
</div>
<ul>
<li>if we were to set it to one, we would iterate over the rows. All but the second row (Mazda RX4 Wag) will return true</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(mtcars_copy, <span class="dv">1</span>, <span class="cf">function</span>(x)<span class="fu">sum</span>(<span class="fu">is.na</span>(x)) <span class="sc">==</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          Mazda RX4       Mazda RX4 Wag          Datsun 710      Hornet 4 Drive 
               TRUE               FALSE                TRUE                TRUE 
  Hornet Sportabout             Valiant          Duster 360           Merc 240D 
               TRUE                TRUE                TRUE                TRUE 
           Merc 230            Merc 280           Merc 280C          Merc 450SE 
               TRUE                TRUE                TRUE                TRUE 
         Merc 450SL         Merc 450SLC  Cadillac Fleetwood Lincoln Continental 
               TRUE                TRUE                TRUE                TRUE 
  Chrysler Imperial            Fiat 128         Honda Civic      Toyota Corolla 
               TRUE                TRUE                TRUE                TRUE 
      Toyota Corona    Dodge Challenger         AMC Javelin          Camaro Z28 
               TRUE                TRUE                TRUE                TRUE 
   Pontiac Firebird           Fiat X1-9       Porsche 914-2        Lotus Europa 
               TRUE                TRUE                TRUE                TRUE 
     Ford Pantera L        Ferrari Dino       Maserati Bora          Volvo 142E 
               TRUE                TRUE                TRUE                TRUE </code></pre>
</div>
</div>
<ul>
<li>finally we can use these indeces of the columsn to select them in <code>[,col_indices]</code></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. apply</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>mtcars_copy[, <span class="fu">apply</span>(mtcars_copy, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)) <span class="sc">==</span> <span class="dv">0</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                     mpg cyl gear carb
Mazda RX4           21.0   6    4    4
Mazda RX4 Wag       21.0   6    4    4
Datsun 710          22.8   4    4    1
Hornet 4 Drive      21.4   6    3    1
Hornet Sportabout   18.7   8    3    2
Valiant             18.1   6    3    1
Duster 360          14.3   8    3    4
Merc 240D           24.4   4    4    2
Merc 230            22.8   4    4    2
Merc 280            19.2   6    4    4
Merc 280C           17.8   6    4    4
Merc 450SE          16.4   8    3    3
Merc 450SL          17.3   8    3    3
Merc 450SLC         15.2   8    3    3
Cadillac Fleetwood  10.4   8    3    4
Lincoln Continental 10.4   8    3    4
Chrysler Imperial   14.7   8    3    4
Fiat 128            32.4   4    4    1
Honda Civic         30.4   4    4    2
Toyota Corolla      33.9   4    4    1
Toyota Corona       21.5   4    3    1
Dodge Challenger    15.5   8    3    2
AMC Javelin         15.2   8    3    2
Camaro Z28          13.3   8    3    4
Pontiac Firebird    19.2   8    3    2
Fiat X1-9           27.3   4    4    1
Porsche 914-2       26.0   4    5    2
Lotus Europa        30.4   4    5    2
Ford Pantera L      15.8   8    5    4
Ferrari Dino        19.7   6    5    6
Maserati Bora       15.0   8    5    8
Volvo 142E          21.4   4    4    2</code></pre>
</div>
</div>
<p><strong>4. using <code>any</code></strong></p>
<ul>
<li>Similar as above. Just not any can be <code>NA</code></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using any</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>mtcars_copy[, <span class="fu">apply</span>(mtcars_copy, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="sc">!</span><span class="fu">any</span>(<span class="fu">is.na</span>(x)))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                     mpg cyl gear carb
Mazda RX4           21.0   6    4    4
Mazda RX4 Wag       21.0   6    4    4
Datsun 710          22.8   4    4    1
Hornet 4 Drive      21.4   6    3    1
Hornet Sportabout   18.7   8    3    2
Valiant             18.1   6    3    1
Duster 360          14.3   8    3    4
Merc 240D           24.4   4    4    2
Merc 230            22.8   4    4    2
Merc 280            19.2   6    4    4
Merc 280C           17.8   6    4    4
Merc 450SE          16.4   8    3    3
Merc 450SL          17.3   8    3    3
Merc 450SLC         15.2   8    3    3
Cadillac Fleetwood  10.4   8    3    4
Lincoln Continental 10.4   8    3    4
Chrysler Imperial   14.7   8    3    4
Fiat 128            32.4   4    4    1
Honda Civic         30.4   4    4    2
Toyota Corolla      33.9   4    4    1
Toyota Corona       21.5   4    3    1
Dodge Challenger    15.5   8    3    2
AMC Javelin         15.2   8    3    2
Camaro Z28          13.3   8    3    4
Pontiac Firebird    19.2   8    3    2
Fiat X1-9           27.3   4    4    1
Porsche 914-2       26.0   4    5    2
Lotus Europa        30.4   4    5    2
Ford Pantera L      15.8   8    5    4
Ferrari Dino        19.7   6    5    6
Maserati Bora       15.0   8    5    8
Volvo 142E          21.4   4    4    2</code></pre>
</div>
</div>
</section>
<section id="selecting-columns-if-the-mean-is-above-ten-or-it-is-a-numeric-column" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="selecting-columns-if-the-mean-is-above-ten-or-it-is-a-numeric-column"><span class="header-section-number">3.3.3</span> Selecting Columns if the mean is above ten or it is a numeric column</h3>
<p><strong>dplyr select</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add a string column</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="st">"string"</span>] <span class="ot">=</span> <span class="st">"a"</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># select only string columns or numeric ones with a mean &gt; 10</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">where</span>(</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(x) <span class="fu">is.character</span>(x) <span class="sc">|</span> <span class="fu">mean</span>(x) <span class="sc">&gt;</span> <span class="dv">10</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mean.default(x): argument is not numeric or logical: returning NA</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                     mpg  disp  hp  qsec string
Mazda RX4           21.0 160.0 110 16.46      a
Mazda RX4 Wag       21.0 160.0 110 17.02      a
Datsun 710          22.8 108.0  93 18.61      a
Hornet 4 Drive      21.4 258.0 110 19.44      a
Hornet Sportabout   18.7 360.0 175 17.02      a
Valiant             18.1 225.0 105 20.22      a
Duster 360          14.3 360.0 245 15.84      a
Merc 240D           24.4 146.7  62 20.00      a
Merc 230            22.8 140.8  95 22.90      a
Merc 280            19.2 167.6 123 18.30      a
Merc 280C           17.8 167.6 123 18.90      a
Merc 450SE          16.4 275.8 180 17.40      a
Merc 450SL          17.3 275.8 180 17.60      a
Merc 450SLC         15.2 275.8 180 18.00      a
Cadillac Fleetwood  10.4 472.0 205 17.98      a
Lincoln Continental 10.4 460.0 215 17.82      a
Chrysler Imperial   14.7 440.0 230 17.42      a
Fiat 128            32.4  78.7  66 19.47      a
Honda Civic         30.4  75.7  52 18.52      a
Toyota Corolla      33.9  71.1  65 19.90      a
Toyota Corona       21.5 120.1  97 20.01      a
Dodge Challenger    15.5 318.0 150 16.87      a
AMC Javelin         15.2 304.0 150 17.30      a
Camaro Z28          13.3 350.0 245 15.41      a
Pontiac Firebird    19.2 400.0 175 17.05      a
Fiat X1-9           27.3  79.0  66 18.90      a
Porsche 914-2       26.0 120.3  91 16.70      a
Lotus Europa        30.4  95.1 113 16.90      a
Ford Pantera L      15.8 351.0 264 14.50      a
Ferrari Dino        19.7 145.0 175 15.50      a
Maserati Bora       15.0 301.0 335 14.60      a
Volvo 142E          21.4 121.0 109 18.60      a</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">where</span>(<span class="cf">function</span>(x){</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">is.numeric</span>(x)){</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mean</span>(x) <span class="sc">&gt;</span> <span class="dv">10</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span>{</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">is.character</span>(x) <span class="co"># must return true or false</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                     mpg  disp  hp  qsec string
Mazda RX4           21.0 160.0 110 16.46      a
Mazda RX4 Wag       21.0 160.0 110 17.02      a
Datsun 710          22.8 108.0  93 18.61      a
Hornet 4 Drive      21.4 258.0 110 19.44      a
Hornet Sportabout   18.7 360.0 175 17.02      a
Valiant             18.1 225.0 105 20.22      a
Duster 360          14.3 360.0 245 15.84      a
Merc 240D           24.4 146.7  62 20.00      a
Merc 230            22.8 140.8  95 22.90      a
Merc 280            19.2 167.6 123 18.30      a
Merc 280C           17.8 167.6 123 18.90      a
Merc 450SE          16.4 275.8 180 17.40      a
Merc 450SL          17.3 275.8 180 17.60      a
Merc 450SLC         15.2 275.8 180 18.00      a
Cadillac Fleetwood  10.4 472.0 205 17.98      a
Lincoln Continental 10.4 460.0 215 17.82      a
Chrysler Imperial   14.7 440.0 230 17.42      a
Fiat 128            32.4  78.7  66 19.47      a
Honda Civic         30.4  75.7  52 18.52      a
Toyota Corolla      33.9  71.1  65 19.90      a
Toyota Corona       21.5 120.1  97 20.01      a
Dodge Challenger    15.5 318.0 150 16.87      a
AMC Javelin         15.2 304.0 150 17.30      a
Camaro Z28          13.3 350.0 245 15.41      a
Pontiac Firebird    19.2 400.0 175 17.05      a
Fiat X1-9           27.3  79.0  66 18.90      a
Porsche 914-2       26.0 120.3  91 16.70      a
Lotus Europa        30.4  95.1 113 16.90      a
Ford Pantera L      15.8 351.0 264 14.50      a
Ferrari Dino        19.7 145.0 175 15.50      a
Maserati Bora       15.0 301.0 335 14.60      a
Volvo 142E          21.4 121.0 109 18.60      a</code></pre>
</div>
</div>
<p><strong>apply|map</strong></p>
<p>take care !Apply returns weird classes!!</p>
<p>Almost all of them should be true! Except the last one…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(mtcars, <span class="dv">2</span>, is.numeric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   mpg    cyl   disp     hp   drat     wt   qsec     vs     am   gear   carb 
 FALSE  FALSE  FALSE  FALSE  FALSE  FALSE  FALSE  FALSE  FALSE  FALSE  FALSE 
string 
 FALSE </code></pre>
</div>
</div>
<ul>
<li>so better use <code>map_lgl</code></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>f_ <span class="ot">=</span> <span class="cf">function</span>(df) {</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">=</span> <span class="fu">map_lgl</span>(df, <span class="cf">function</span>(x) {</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.numeric</span>(x)) {</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">mean</span>(x) <span class="sc">&gt;</span> <span class="dv">20</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.character</span>(x)) {</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">TRUE</span>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(idx)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>mtcars[,<span class="fu">f_</span>(mtcars)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                     mpg  disp  hp string
Mazda RX4           21.0 160.0 110      a
Mazda RX4 Wag       21.0 160.0 110      a
Datsun 710          22.8 108.0  93      a
Hornet 4 Drive      21.4 258.0 110      a
Hornet Sportabout   18.7 360.0 175      a
Valiant             18.1 225.0 105      a
Duster 360          14.3 360.0 245      a
Merc 240D           24.4 146.7  62      a
Merc 230            22.8 140.8  95      a
Merc 280            19.2 167.6 123      a
Merc 280C           17.8 167.6 123      a
Merc 450SE          16.4 275.8 180      a
Merc 450SL          17.3 275.8 180      a
Merc 450SLC         15.2 275.8 180      a
Cadillac Fleetwood  10.4 472.0 205      a
Lincoln Continental 10.4 460.0 215      a
Chrysler Imperial   14.7 440.0 230      a
Fiat 128            32.4  78.7  66      a
Honda Civic         30.4  75.7  52      a
Toyota Corolla      33.9  71.1  65      a
Toyota Corona       21.5 120.1  97      a
Dodge Challenger    15.5 318.0 150      a
AMC Javelin         15.2 304.0 150      a
Camaro Z28          13.3 350.0 245      a
Pontiac Firebird    19.2 400.0 175      a
Fiat X1-9           27.3  79.0  66      a
Porsche 914-2       26.0 120.3  91      a
Lotus Europa        30.4  95.1 113      a
Ford Pantera L      15.8 351.0 264      a
Ferrari Dino        19.7 145.0 175      a
Maserati Bora       15.0 301.0 335      a
Volvo 142E          21.4 121.0 109      a</code></pre>
</div>
</div>
</section>
<section id="select-columns-if-the-first-value-in-the-column-is" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4" class="anchored" data-anchor-id="select-columns-if-the-first-value-in-the-column-is"><span class="header-section-number">3.3.4</span> Select Columns if the first value in the column is …</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">where</span>(</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(x)x[[<span class="dv">1</span>]] <span class="sc">==</span> <span class="st">"a"</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                    string
Mazda RX4                a
Mazda RX4 Wag            a
Datsun 710               a
Hornet 4 Drive           a
Hornet Sportabout        a
Valiant                  a
Duster 360               a
Merc 240D                a
Merc 230                 a
Merc 280                 a
Merc 280C                a
Merc 450SE               a
Merc 450SL               a
Merc 450SLC              a
Cadillac Fleetwood       a
Lincoln Continental      a
Chrysler Imperial        a
Fiat 128                 a
Honda Civic              a
Toyota Corolla           a
Toyota Corona            a
Dodge Challenger         a
AMC Javelin              a
Camaro Z28               a
Pontiac Firebird         a
Fiat X1-9                a
Porsche 914-2            a
Lotus Europa             a
Ford Pantera L           a
Ferrari Dino             a
Maserati Bora            a
Volvo 142E               a</code></pre>
</div>
</div>
</section>
<section id="where-vs-normal-tidy-select" class="level3" data-number="3.3.5">
<h3 data-number="3.3.5" class="anchored" data-anchor-id="where-vs-normal-tidy-select"><span class="header-section-number">3.3.5</span> where vs “normal” tidy select</h3>
<p>The docs say about where:</p>
<blockquote class="blockquote">
<p>where(): Applies a function to all variables and selects those for which the function returns TRUE.</p>
</blockquote>
<p>So it essentially loops over the columns like lapply, whereas a code like this using the selection helpers only looks at the names of the variables:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"^d"</span>)) <span class="sc">%&gt;%</span> head</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                  disp drat
Mazda RX4          160 3.90
Mazda RX4 Wag      160 3.90
Datsun 710         108 3.85
Hornet 4 Drive     258 3.08
Hornet Sportabout  360 3.15
Valiant            225 2.76</code></pre>
</div>
</div>
<p>This works because the “normal” select also takes indexes and by looping over the columns with <code>map_dbl</code> and checking which mean &gt; 10 returns 1 we get the indexes</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">which</span>(<span class="fu">map_dbl</span>(.,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>                                <span class="sc">~</span> <span class="fu">mean</span>(.x <span class="sc">&gt;</span> <span class="dv">10</span>)) <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="at">n=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              mpg disp  hp  qsec string
Mazda RX4      21  160 110 16.46      a
Mazda RX4 Wag  21  160 110 17.02      a</code></pre>
</div>
</div>
<p>The same with <code>where</code> just that we need to take care of the string column as the function would return <code>NA</code> and that cant be used as index..</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">~</span><span class="fu">mean</span>(.x) <span class="sc">&gt;</span> <span class="dv">10</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">mean</span>(.x))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mean.default(.x): argument is not numeric or logical: returning NA

Warning in mean.default(.x): argument is not numeric or logical: returning NA</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                     mpg  disp  hp  qsec
Mazda RX4           21.0 160.0 110 16.46
Mazda RX4 Wag       21.0 160.0 110 17.02
Datsun 710          22.8 108.0  93 18.61
Hornet 4 Drive      21.4 258.0 110 19.44
Hornet Sportabout   18.7 360.0 175 17.02
Valiant             18.1 225.0 105 20.22
Duster 360          14.3 360.0 245 15.84
Merc 240D           24.4 146.7  62 20.00
Merc 230            22.8 140.8  95 22.90
Merc 280            19.2 167.6 123 18.30
Merc 280C           17.8 167.6 123 18.90
Merc 450SE          16.4 275.8 180 17.40
Merc 450SL          17.3 275.8 180 17.60
Merc 450SLC         15.2 275.8 180 18.00
Cadillac Fleetwood  10.4 472.0 205 17.98
Lincoln Continental 10.4 460.0 215 17.82
Chrysler Imperial   14.7 440.0 230 17.42
Fiat 128            32.4  78.7  66 19.47
Honda Civic         30.4  75.7  52 18.52
Toyota Corolla      33.9  71.1  65 19.90
Toyota Corona       21.5 120.1  97 20.01
Dodge Challenger    15.5 318.0 150 16.87
AMC Javelin         15.2 304.0 150 17.30
Camaro Z28          13.3 350.0 245 15.41
Pontiac Firebird    19.2 400.0 175 17.05
Fiat X1-9           27.3  79.0  66 18.90
Porsche 914-2       26.0 120.3  91 16.70
Lotus Europa        30.4  95.1 113 16.90
Ford Pantera L      15.8 351.0 264 14.50
Ferrari Dino        19.7 145.0 175 15.50
Maserati Bora       15.0 301.0 335 14.60
Volvo 142E          21.4 121.0 109 18.60</code></pre>
</div>
</div>
</section>
</section>
<section id="filtering-rows" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="filtering-rows"><span class="header-section-number">3.4</span> Filtering Rows</h2>
</section>
<section id="adding-new-columns" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="adding-new-columns"><span class="header-section-number">3.5</span> Adding new Columns</h2>
<section id="rowwise-compute-value-for-new-column-with-subset-of-existing-columns" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1" class="anchored" data-anchor-id="rowwise-compute-value-for-new-column-with-subset-of-existing-columns"><span class="header-section-number">3.5.1</span> Rowwise Compute value for new column with subset of existing columns</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pmap loops over multiple lists|vectors at the same time</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># in this case all the numeric columns in mtcars</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the ~median(c(...)) says take all the cols</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">med =</span> <span class="fu">pmap_dbl</span>(<span class="fu">select</span>(., <span class="fu">where</span>(is.numeric)), <span class="sc">~</span><span class="fu">median</span>(<span class="fu">c</span>(...), <span class="at">na.rm =</span> T))</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">%&gt;%</span> glimpse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 32
Columns: 13
$ mpg    &lt;dbl&gt; 21.0, 21.0, 22.8, 21.4, 18.7, 18.1, 14.3, 24.4, 22.8, 19.2, 17.…
$ cyl    &lt;dbl&gt; 6, 6, 4, 6, 8, 6, 8, 4, 4, 6, 6, 8, 8, 8, 8, 8, 8, 4, 4, 4, 4, …
$ disp   &lt;dbl&gt; 160.0, 160.0, 108.0, 258.0, 360.0, 225.0, 360.0, 146.7, 140.8, …
$ hp     &lt;dbl&gt; 110, 110, 93, 110, 175, 105, 245, 62, 95, 123, 123, 180, 180, 1…
$ drat   &lt;dbl&gt; 3.90, 3.90, 3.85, 3.08, 3.15, 2.76, 3.21, 3.69, 3.92, 3.92, 3.9…
$ wt     &lt;dbl&gt; 2.620, 2.875, 2.320, 3.215, 3.440, 3.460, 3.570, 3.190, 3.150, …
$ qsec   &lt;dbl&gt; 16.46, 17.02, 18.61, 19.44, 17.02, 20.22, 15.84, 20.00, 22.90, …
$ vs     &lt;dbl&gt; 0, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, …
$ am     &lt;dbl&gt; 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, …
$ gear   &lt;dbl&gt; 4, 4, 4, 3, 3, 3, 3, 4, 4, 4, 4, 3, 3, 3, 3, 3, 3, 4, 4, 4, 3, …
$ carb   &lt;dbl&gt; 4, 4, 1, 1, 2, 1, 4, 2, 2, 4, 4, 3, 3, 3, 4, 4, 4, 1, 2, 1, 1, …
$ string &lt;chr&gt; "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a"…
$ med    &lt;dbl&gt; 4.000, 4.000, 4.000, 3.215, 3.440, 3.460, 4.000, 4.000, 4.000, …</code></pre>
</div>
</div>
<p>do the same as above, but only use two cols and get their mean</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">med =</span> <span class="fu">pmap_dbl</span>(<span class="fu">select</span>(., <span class="fu">matches</span>(<span class="st">"disp|hp"</span>)), <span class="sc">~</span><span class="fu">median</span>(<span class="fu">c</span>(...), <span class="at">na.rm =</span> T))</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">%&gt;%</span> glimpse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 32
Columns: 13
$ mpg    &lt;dbl&gt; 21.0, 21.0, 22.8, 21.4, 18.7, 18.1, 14.3, 24.4, 22.8, 19.2, 17.…
$ cyl    &lt;dbl&gt; 6, 6, 4, 6, 8, 6, 8, 4, 4, 6, 6, 8, 8, 8, 8, 8, 8, 4, 4, 4, 4, …
$ disp   &lt;dbl&gt; 160.0, 160.0, 108.0, 258.0, 360.0, 225.0, 360.0, 146.7, 140.8, …
$ hp     &lt;dbl&gt; 110, 110, 93, 110, 175, 105, 245, 62, 95, 123, 123, 180, 180, 1…
$ drat   &lt;dbl&gt; 3.90, 3.90, 3.85, 3.08, 3.15, 2.76, 3.21, 3.69, 3.92, 3.92, 3.9…
$ wt     &lt;dbl&gt; 2.620, 2.875, 2.320, 3.215, 3.440, 3.460, 3.570, 3.190, 3.150, …
$ qsec   &lt;dbl&gt; 16.46, 17.02, 18.61, 19.44, 17.02, 20.22, 15.84, 20.00, 22.90, …
$ vs     &lt;dbl&gt; 0, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, …
$ am     &lt;dbl&gt; 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, …
$ gear   &lt;dbl&gt; 4, 4, 4, 3, 3, 3, 3, 4, 4, 4, 4, 3, 3, 3, 3, 3, 3, 4, 4, 4, 3, …
$ carb   &lt;dbl&gt; 4, 4, 1, 1, 2, 1, 4, 2, 2, 4, 4, 3, 3, 3, 4, 4, 4, 1, 2, 1, 1, …
$ string &lt;chr&gt; "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a"…
$ med    &lt;dbl&gt; 135.00, 135.00, 100.50, 184.00, 267.50, 165.00, 302.50, 104.35,…</code></pre>
</div>
</div>
<p>or simpler if you know the columns</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">med =</span> <span class="fu">median</span>(disp, hp)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> glimpse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 32
Columns: 13
Rowwise: 
$ mpg    &lt;dbl&gt; 21.0, 21.0, 22.8, 21.4, 18.7, 18.1, 14.3, 24.4, 22.8, 19.2, 17.…
$ cyl    &lt;dbl&gt; 6, 6, 4, 6, 8, 6, 8, 4, 4, 6, 6, 8, 8, 8, 8, 8, 8, 4, 4, 4, 4, …
$ disp   &lt;dbl&gt; 160.0, 160.0, 108.0, 258.0, 360.0, 225.0, 360.0, 146.7, 140.8, …
$ hp     &lt;dbl&gt; 110, 110, 93, 110, 175, 105, 245, 62, 95, 123, 123, 180, 180, 1…
$ drat   &lt;dbl&gt; 3.90, 3.90, 3.85, 3.08, 3.15, 2.76, 3.21, 3.69, 3.92, 3.92, 3.9…
$ wt     &lt;dbl&gt; 2.620, 2.875, 2.320, 3.215, 3.440, 3.460, 3.570, 3.190, 3.150, …
$ qsec   &lt;dbl&gt; 16.46, 17.02, 18.61, 19.44, 17.02, 20.22, 15.84, 20.00, 22.90, …
$ vs     &lt;dbl&gt; 0, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, …
$ am     &lt;dbl&gt; 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, …
$ gear   &lt;dbl&gt; 4, 4, 4, 3, 3, 3, 3, 4, 4, 4, 4, 3, 3, 3, 3, 3, 3, 4, 4, 4, 3, …
$ carb   &lt;dbl&gt; 4, 4, 1, 1, 2, 1, 4, 2, 2, 4, 4, 3, 3, 3, 4, 4, 4, 1, 2, 1, 1, …
$ string &lt;chr&gt; "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a"…
$ med    &lt;dbl&gt; 160.0, 160.0, 108.0, 258.0, 360.0, 225.0, 360.0, 146.7, 140.8, …</code></pre>
</div>
</div>
</section>
</section>
<section id="adding-column-indicating-if-group-if-max-value-in-group-is-in-top-n-max-values-per-group" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="adding-column-indicating-if-group-if-max-value-in-group-is-in-top-n-max-values-per-group"><span class="header-section-number">3.6</span> Adding column indicating if group if max value in group is in top-n max values per group</h2>
<p><strong>Steps: </strong></p>
<ol type="1">
<li><p><code>group_by</code> the grouping variable</p></li>
<li><p>summarise get the max value per group</p></li>
<li><p><code>inner_join</code> the result with the original data-frame</p></li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># which of the cyl-groups  contains the highest disp</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>top <span class="ot">=</span> mtcars <span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">m =</span> <span class="fu">max</span>(disp)) <span class="sc">%&gt;%</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(m)) <span class="sc">%&gt;%</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">top2 =</span> <span class="fu">if_else</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">1</span>, T, F)) <span class="sc">%&gt;%</span> </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    ., mtcars, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"cyl"</span>)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>top</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 32 × 14
     cyl     m top2    mpg  disp    hp  drat    wt  qsec    vs    am  gear  carb
   &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     8   472 TRUE   18.7  360    175  3.15  3.44  17.0     0     0     3     2
 2     8   472 TRUE   14.3  360    245  3.21  3.57  15.8     0     0     3     4
 3     8   472 TRUE   16.4  276.   180  3.07  4.07  17.4     0     0     3     3
 4     8   472 TRUE   17.3  276.   180  3.07  3.73  17.6     0     0     3     3
 5     8   472 TRUE   15.2  276.   180  3.07  3.78  18       0     0     3     3
 6     8   472 TRUE   10.4  472    205  2.93  5.25  18.0     0     0     3     4
 7     8   472 TRUE   10.4  460    215  3     5.42  17.8     0     0     3     4
 8     8   472 TRUE   14.7  440    230  3.23  5.34  17.4     0     0     3     4
 9     8   472 TRUE   15.5  318    150  2.76  3.52  16.9     0     0     3     2
10     8   472 TRUE   15.2  304    150  3.15  3.44  17.3     0     0     3     2
# ℹ 22 more rows
# ℹ 1 more variable: string &lt;chr&gt;</code></pre>
</div>
</div>
<section id="example-of-stackoverflow" class="level5" data-number="3.6.0.0.1">
<h5 data-number="3.6.0.0.1" class="anchored" data-anchor-id="example-of-stackoverflow"><span class="header-section-number">3.6.0.0.1</span> example of STACKOVERFLOW</h5>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">structure</span>(<span class="fu">list</span>(<span class="at">id =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>, </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">9</span>, <span class="dv">9</span>, <span class="dv">9</span>, <span class="dv">9</span>, <span class="dv">9</span>, <span class="dv">9</span>, <span class="dv">9</span>, <span class="dv">9</span>, <span class="dv">9</span>), <span class="at">year =</span> <span class="fu">c</span>(<span class="st">"2017"</span>, <span class="st">"2018"</span>, </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="st">"2019"</span>, <span class="st">"2020"</span>, <span class="st">"2021"</span>, <span class="st">"2022"</span>, <span class="st">"2023"</span>, <span class="st">"2024"</span>, <span class="st">"2025"</span>, <span class="st">"2026"</span>, </span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="st">"2017"</span>, <span class="st">"2018"</span>, <span class="st">"2019"</span>, <span class="st">"2020"</span>, <span class="st">"2021"</span>, <span class="st">"2022"</span>, <span class="st">"2023"</span>, <span class="st">"2024"</span>, </span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="st">"2025"</span>, <span class="st">"2026"</span>, <span class="st">"2017"</span>, <span class="st">"2018"</span>, <span class="st">"2019"</span>, <span class="st">"2020"</span>, <span class="st">"2021"</span>, <span class="st">"2022"</span>, </span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="st">"2023"</span>, <span class="st">"2024"</span>, <span class="st">"2025"</span>, <span class="st">"2026"</span>, <span class="st">"2017"</span>, <span class="st">"2018"</span>, <span class="st">"2019"</span>, <span class="st">"2020"</span>, </span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="st">"2021"</span>, <span class="st">"2022"</span>, <span class="st">"2023"</span>, <span class="st">"2024"</span>, <span class="st">"2025"</span>, <span class="st">"2026"</span>, <span class="st">"2017"</span>, <span class="st">"2018"</span>, </span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="st">"2019"</span>, <span class="st">"2020"</span>, <span class="st">"2021"</span>, <span class="st">"2022"</span>, <span class="st">"2023"</span>, <span class="st">"2024"</span>, <span class="st">"2025"</span>, <span class="st">"2026"</span>, </span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="st">"2017"</span>, <span class="st">"2018"</span>, <span class="st">"2019"</span>, <span class="st">"2020"</span>, <span class="st">"2021"</span>, <span class="st">"2022"</span>, <span class="st">"2023"</span>, <span class="st">"2024"</span>, </span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="st">"2025"</span>, <span class="st">"2026"</span>, <span class="st">"2017"</span>, <span class="st">"2018"</span>, <span class="st">"2019"</span>, <span class="st">"2020"</span>, <span class="st">"2021"</span>, <span class="st">"2022"</span>, </span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="st">"2023"</span>, <span class="st">"2024"</span>, <span class="st">"2025"</span>, <span class="st">"2026"</span>, <span class="st">"2017"</span>, <span class="st">"2018"</span>, <span class="st">"2019"</span>, <span class="st">"2020"</span>, </span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="st">"2021"</span>, <span class="st">"2022"</span>, <span class="st">"2023"</span>, <span class="st">"2024"</span>, <span class="st">"2025"</span>, <span class="st">"2026"</span>, <span class="st">"2017"</span>, <span class="st">"2018"</span>, </span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="st">"2019"</span>, <span class="st">"2020"</span>, <span class="st">"2021"</span>, <span class="st">"2022"</span>, <span class="st">"2023"</span>, <span class="st">"2024"</span>, <span class="st">"2025"</span>, <span class="st">"2026"</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>), <span class="at">volume =</span> <span class="fu">c</span>(<span class="fl">0.0013</span>, <span class="fl">0.0013</span>, <span class="fl">0.0012579</span>, <span class="fl">0.0011895</span>, <span class="fl">0.0011421</span>, </span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="fl">0.0010842</span>, <span class="fl">0.0010211</span>, <span class="fl">0.0010158</span>, <span class="fl">0.00099474</span>, <span class="fl">0.00092632</span>, <span class="fl">0.07878</span>, </span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="fl">0.078791</span>, <span class="fl">0.077295</span>, <span class="fl">0.076638</span>, <span class="fl">0.075538</span>, <span class="fl">0.074468</span>, <span class="fl">0.074776</span>, <span class="fl">0.074051</span>, </span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a><span class="fl">0.071706</span>, <span class="fl">0.068056</span>, <span class="fl">0.023269</span>, <span class="fl">0.023011</span>, <span class="fl">0.022374</span>, <span class="fl">0.021962</span>, <span class="fl">0.021408</span>, </span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="fl">0.020949</span>, <span class="fl">0.020811</span>, <span class="fl">0.020354</span>, <span class="fl">0.019309</span>, <span class="fl">0.018042</span>, <span class="fl">0.0004</span>, <span class="fl">0.0004</span>, </span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="fl">0.00038421</span>, <span class="fl">0.00035263</span>, <span class="fl">0.00033158</span>, <span class="fl">0.00032105</span>, <span class="fl">0.00026842</span>, <span class="fl">0.00028421</span>, </span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a><span class="fl">0.00026842</span>, <span class="fl">0.00024211</span>, <span class="fl">0.0002</span>, <span class="fl">0.0001</span>, <span class="fl">0.00011579</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, </span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.028422</span>, <span class="fl">0.028361</span>, <span class="fl">0.027768</span>, <span class="fl">0.027501</span>, <span class="fl">0.027029</span>, </span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a><span class="fl">0.02651</span>, <span class="fl">0.026588</span>, <span class="fl">0.026209</span>, <span class="fl">0.025094</span>, <span class="fl">0.023391</span>, <span class="fl">0.0001</span>, <span class="fl">0.0001</span>, </span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.0047</span>, <span class="fl">0.0047158</span>, <span class="fl">0.0048368</span>, <span class="fl">0.0048316</span>, </span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a><span class="fl">0.0049263</span>, <span class="fl">0.0049737</span>, <span class="fl">0.0049947</span>, <span class="fl">0.0051684</span>, <span class="fl">0.0052526</span>, <span class="fl">0.0051842</span>, </span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a><span class="fl">0.0106</span>, <span class="fl">0.010389</span>, <span class="fl">0.010279</span>, <span class="fl">0.010005</span>, <span class="fl">0.0098421</span>, <span class="fl">0.0096368</span>, <span class="fl">0.0094053</span>, </span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a><span class="fl">0.0093368</span>, <span class="fl">0.0092526</span>, <span class="fl">0.0089316</span>)), <span class="at">class =</span> <span class="fu">c</span>(<span class="st">"tbl_df"</span>, <span class="st">"tbl"</span>, </span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a><span class="st">"data.frame"</span>), <span class="at">row.names =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="sc">-</span>90L))</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">m =</span> <span class="fu">max</span>(volume)) <span class="sc">%&gt;%</span></span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(m)) <span class="sc">%&gt;%</span></span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">top3 =</span> <span class="fu">if_else</span>(<span class="fu">row_number</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), T, F)) <span class="sc">%&gt;%</span></span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(., df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span>)) <span class="ot">-&gt;</span> top123</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="list-columns-and-dplyr" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="list-columns-and-dplyr"><span class="header-section-number">3.7</span> list Columns (and <code>dplyr</code>)</h2>
<ul>
<li>tibbles and dataframes are lists of vectors!!</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>l <span class="ot">=</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">runif</span>(<span class="dv">10</span>),</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "list"</code></pre>
</div>
</div>
<p><img src="images/tibble.png" class="img-fluid"> <a href="https://dcl-prog.stanford.edu/list-columns.html">image source:</a></p>
<ul>
<li>Meaning each column is a vector. Usually these are atomic vectors (recall chapter .. TODO in advanced R..), but these can also be lists.</li>
</ul>
<p><img src="images/tibble-list-col.png" class="img-fluid"> <a href="https://dcl-prog.stanford.edu/list-columns.html">image source:</a></p>
<ul>
<li>List columns are much more versatile than atomic vectors. They can contain atomic vectors, other lists, tibbles, …</li>
</ul>
<section id="creating-list-columns" class="level3" data-number="3.7.1">
<h3 data-number="3.7.1" class="anchored" data-anchor-id="creating-list-columns"><span class="header-section-number">3.7.1</span> Creating List Columns</h3>
<ul>
<li><p>It seems to be common to create list columns by modifying an existing “normal” tibble. Three common ways are:</p>
<ul>
<li><code>nest()</code></li>
<li><code>summarise</code> and <code>list</code></li>
<li><code>mutate</code> and <code>map</code></li>
</ul></li>
</ul>
<section id="nest" class="level4" data-number="3.7.1.1">
<h4 data-number="3.7.1.1" class="anchored" data-anchor-id="nest"><span class="header-section-number">3.7.1.1</span> <code>nest()</code></h4>
<ul>
<li><p>When calling <code>nest</code> the first argument is the new column-name. In this case it is <code>cars</code>.</p></li>
<li><p>The second argument are the columns you want to have in the resulting dataframe in each element of the list column.</p></li>
<li><p>Each column you do not specify automatically becomes a <em>grouping variable</em> and all the resulting tibble will have as many rows as unique combinations in these <em>grouping variables</em> there are.</p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>mtcars_with_list_col <span class="ot">=</span> mtcars <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cyl, mpg, name) <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">cars =</span> <span class="fu">c</span>(mpg, name))</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect it</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mtcars_with_list_col)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [3 × 2] (S3: tbl_df/tbl/data.frame)
 $ cyl : num [1:3] 6 4 8
 $ cars:List of 3
  ..$ : tibble [7 × 2] (S3: tbl_df/tbl/data.frame)
  .. ..$ mpg : num [1:7] 21 21 21.4 18.1 19.2 17.8 19.7
  .. ..$ name: chr [1:7] "Mazda RX4" "Mazda RX4 Wag" "Hornet 4 Drive" "Valiant" ...
  ..$ : tibble [11 × 2] (S3: tbl_df/tbl/data.frame)
  .. ..$ mpg : num [1:11] 22.8 24.4 22.8 32.4 30.4 33.9 21.5 27.3 26 30.4 ...
  .. ..$ name: chr [1:11] "Datsun 710" "Merc 240D" "Merc 230" "Fiat 128" ...
  ..$ : tibble [14 × 2] (S3: tbl_df/tbl/data.frame)
  .. ..$ mpg : num [1:14] 18.7 14.3 16.4 17.3 15.2 10.4 10.4 14.7 15.5 15.2 ...
  .. ..$ name: chr [1:14] "Hornet Sportabout" "Duster 360" "Merc 450SE" "Merc 450SL" ...</code></pre>
</div>
</div>
</section>
<section id="summarise-and-list" class="level4" data-number="3.7.1.2">
<h4 data-number="3.7.1.2" class="anchored" data-anchor-id="summarise-and-list"><span class="header-section-number">3.7.1.2</span> <code>summarise</code> and <code>list</code></h4>
<ul>
<li><p>Normally you use <code>group_by</code> and <code>summarise</code> to collapse groups into single rows.</p></li>
<li><p>You can also use <code>group_by</code>, <code>summarise</code> and <code>list</code> to create atomic vectors where each vector corresponds to one group of <code>cyl</code></p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>mtcars_names_per_cyl <span class="ot">=</span> mtcars <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cars_per_cyl =</span> <span class="fu">list</span>(name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>What if you want to manipulate each vector before putting it into the list column</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>mtcars_names_per_cyl_sorted <span class="ot">=</span> mtcars <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cars_per_cyl =</span> <span class="fu">list</span>(<span class="fu">sort</span>(name)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="mutate-and-map" class="level4" data-number="3.7.1.3">
<h4 data-number="3.7.1.3" class="anchored" data-anchor-id="mutate-and-map"><span class="header-section-number">3.7.1.3</span> <code>mutate</code> and <code>map</code></h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>n_values_per_car_letter <span class="ot">=</span> mtcars <span class="sc">%&gt;%</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">random =</span> <span class="fu">map</span>(name, <span class="sc">~</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">str_length</span>(.x)))) <span class="sc">%&gt;%</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, random)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(n_values_per_car_letter)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   32 obs. of  2 variables:
 $ name  : chr  "Mazda RX4" "Mazda RX4 Wag" "Datsun 710" "Hornet 4 Drive" ...
 $ random:List of 32
  ..$ : num  -0.195 -0.184 -1.368 0.846 2.033 ...
  ..$ : num  1.95 -1.198 0.853 -0.767 -0.574 ...
  ..$ : num  1.78 1.217 0.113 0.972 0.736 ...
  ..$ : num  0.269288 -0.000404 1.121984 -1.387668 -0.210925 ...
  ..$ : num  0.2822 -1.1945 1.0201 0.054 -0.0213 ...
  ..$ : num  -0.0744 -1.1625 0.7702 -0.1963 0.2054 ...
  ..$ : num  1.981 -1.106 -0.361 1.077 -0.934 ...
  ..$ : num  -0.0841 0.7739 -0.0121 0.6751 -1.5646 ...
  ..$ : num  -1.904 -1.699 -1.12 0.486 -1.186 ...
  ..$ : num  -1.406 -0.23 2.439 -0.539 0.339 ...
  ..$ : num  0.586 -0.797 0.342 -1.053 -1.277 ...
  ..$ : num  0.6337 0.2869 -0.4436 -1.3288 0.0312 ...
  ..$ : num  1.232 0.246 -0.746 -1.04 -1.523 ...
  ..$ : num  -0.9038 -0.5822 0.3398 0.0425 0.6088 ...
  ..$ : num  -0.281 -1.098 0.493 0.063 -0.245 ...
  ..$ : num  -0.62 1.7 -1.036 0.302 0.788 ...
  ..$ : num  0.204 -1.111 0.251 1.865 -0.609 ...
  ..$ : num  -0.0874 1.3393 0.291 1.0198 0.2712 ...
  ..$ : num  -0.986 0.64 -2.273 -1.432 -0.485 ...
  ..$ : num  0.563189 0.879347 0.337097 -0.360936 0.000299 ...
  ..$ : num  -0.98 -0.149 2.472 -1.621 -0.935 ...
  ..$ : num  -0.332 0.066 1.237 0.946 0.119 ...
  ..$ : num  0.3958 0.0535 -0.4067 -1.2724 -0.2164 ...
  ..$ : num  0.127 0.814 0.698 1.298 0.927 ...
  ..$ : num  -0.9758 -0.0991 1.136 -0.8737 0.1375 ...
  ..$ : num  -1.091 -0.453 -0.488 0.77 1.143 ...
  ..$ : num  0.06291 1.41201 0.00426 0.57423 2.00933 ...
  ..$ : num  -0.661 -0.408 -0.175 -1.412 -0.545 ...
  ..$ : num  -1.233 -0.819 1.935 0.673 1.778 ...
  ..$ : num  0.632 0.865 -1.132 0.926 0.468 ...
  ..$ : num  -1.128 -0.472 -1.043 0.193 -0.249 ...
  ..$ : num  -0.92 0.112 -0.135 -1.688 -1.949 ...</code></pre>
</div>
</div>
</section>
</section>
<section id="manipulating" class="level3" data-number="3.7.2">
<h3 data-number="3.7.2" class="anchored" data-anchor-id="manipulating"><span class="header-section-number">3.7.2</span> Manipulating</h3>
<ul>
<li>say you want to get the number of rows for each data.frame in a list column</li>
</ul>
<p><strong>Version 1</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">data_per_cyl =</span> <span class="sc">!</span>cyl) <span class="sc">%&gt;%</span> </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow_per_cyl =</span> <span class="fu">map_dbl</span>(data_per_cyl, nrow)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
    cyl data_per_cyl       nrow_per_cyl
  &lt;dbl&gt; &lt;list&gt;                    &lt;dbl&gt;
1     6 &lt;tibble [7 × 12]&gt;             7
2     4 &lt;tibble [11 × 12]&gt;           11
3     8 &lt;tibble [14 × 12]&gt;           14</code></pre>
</div>
</div>
<p><strong>Version 2</strong></p>
<ul>
<li>usig <code>rowwise</code></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">data_per_cyl =</span> <span class="sc">!</span>cyl) <span class="sc">%&gt;%</span> </span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow_per_cyl =</span> <span class="fu">nrow</span>(data_per_cyl)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
# Rowwise: 
    cyl data_per_cyl       nrow_per_cyl
  &lt;dbl&gt; &lt;list&gt;                    &lt;int&gt;
1     6 &lt;tibble [7 × 12]&gt;             7
2     4 &lt;tibble [11 × 12]&gt;           11
3     8 &lt;tibble [14 × 12]&gt;           14</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./datatypes.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Types</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./mapping.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Mapping</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>